(function(g){var window=this;'use strict';var hCA=function(X){var c=new g.Gu("und",new g.hF("Default","und",!0));c.captionTracks=X.captionTracks;return c},AWr=function(X){return new g.Ee(function(c,V){var G=X.length,n=[];
if(G)for(var L=function(Y,H){G--;n[Y]=H;G==0&&c(n)},d=function(Y){V(Y)},h,A=0;A<X.length;A++)h=X[A],g.idj(h,g.qL(L,A),d);
else c(n)})},l2=function(X){this.J=X},MW=function(){l2.apply(this,arguments)},Y2z=function(){MW.apply(this,arguments)},jnM=function(){MW.apply(this,arguments)},Hct=function(){MW.apply(this,arguments)},a4A=function(){MW.apply(this,arguments)},$Xi=function(){MW.apply(this,arguments)},WYr=function(){MW.apply(this,arguments)},w0G=function(){l2.apply(this,arguments)},FYh=function(){MW.apply(this,arguments)},Es7=function(){MW.apply(this,arguments)},rWz=function(){MW.apply(this,arguments)},Qnr=function(){MW.apply(this,
arguments)},ZcM=function(){MW.apply(this,arguments)},xXh=function(){MW.apply(this,arguments)},vsA=function(){MW.apply(this,arguments)},kap=function(){MW.apply(this,arguments)},osp=function(){MW.apply(this,arguments)},eCV=function(){MW.apply(this,arguments)},JWk=function(){MW.apply(this,arguments)},mXG=function(){MW.apply(this,arguments)},RCV=function(){l2.apply(this,arguments)},bcz=function(){MW.apply(this,arguments)},tGt=function(){MW.apply(this,arguments)},OcG=function(){MW.apply(this,arguments)},
l4A=function(){MW.apply(this,arguments)},MGz=function(){MW.apply(this,arguments)},gsz=function(){MW.apply(this,arguments)},f4U=function(){MW.apply(this,arguments)},p0G=function(){MW.apply(this,arguments)},I4z=function(){MW.apply(this,arguments)},N6H=function(){l2.apply(this,arguments)},UX7=function(){l2.apply(this,arguments)},T6i=function(){l2.apply(this,arguments)},u9V=function(){MW.apply(this,arguments)},PmV=function(){MW.apply(this,arguments)},zCH=function(){MW.apply(this,arguments)},B6r=function(){MW.apply(this,
arguments)},KYA=function(){MW.apply(this,arguments)},snh=function(){MW.apply(this,arguments)},Cmk=function(){MW.apply(this,arguments)},DXU=function(){MW.apply(this,arguments)},S2G=function(){MW.apply(this,arguments)},icM=function(){MW.apply(this,arguments)},q2h=function(){MW.apply(this,arguments)},XFt=function(){MW.apply(this,arguments)},ckA=function(){MW.apply(this,arguments)},VyV=function(){MW.apply(this,arguments)},Gq_=function(){MW.apply(this,arguments)},nrh=function(){MW.apply(this,arguments)},
LiV=function(){MW.apply(this,arguments)},dvk=function(){MW.apply(this,arguments)},ykM=function(){MW.apply(this,arguments)},haH=function(){MW.apply(this,arguments)},Ak_=function(){MW.apply(this,arguments)},YAi=function(){MW.apply(this,arguments)},jtk=function(){MW.apply(this,arguments)},HN7=function(){MW.apply(this,arguments)},awz=function(){MW.apply(this,arguments)},$vi=function(){MW.apply(this,arguments)},Wi7=function(){l2.apply(this,arguments)},wF7=function(){MW.apply(this,arguments)},FiA=function(){MW.apply(this,
arguments)},Erp=function(){MW.apply(this,arguments)},rkA=function(){MW.apply(this,arguments)},QtG=function(){MW.apply(this,arguments)},ZNV=function(){MW.apply(this,arguments)},xvV=function(){MW.apply(this,arguments)},vrz=function(){MW.apply(this,arguments)},kq_=function(){MW.apply(this,arguments)},orM=function(){MW.apply(this,arguments)},eaV=function(){MW.apply(this,arguments)},Jkh=function(){MW.apply(this,arguments)},mvA=function(){MW.apply(this,arguments)},Raz=function(){MW.apply(this,arguments)},
bNV=function(){MW.apply(this,arguments)},tyU=function(){MW.apply(this,arguments)},ONV=function(){MW.apply(this,arguments)},lw7=function(){MW.apply(this,arguments)},MyA=function(){MW.apply(this,arguments)},grh=function(){MW.apply(this,arguments)},fwA=function(){MW.apply(this,arguments)},pFp=function(){MW.apply(this,arguments)},IwA=function(){MW.apply(this,arguments)},NTt=function(){MW.apply(this,arguments)},UvU=function(){MW.apply(this,arguments)},TTM=function(){MW.apply(this,arguments)},uyk=function(){MW.apply(this,
arguments)},P0t=function(){MW.apply(this,arguments)},zap=function(){MW.apply(this,arguments)},BTt=function(){MW.apply(this,arguments)},KiA=function(){MW.apply(this,arguments)},stA=function(X){X=X.key||X.id;
if(!X)throw Error("Entity key is missing");return X},C0A=function(){if(gX)return gX();
var X={};gX=g.nr("PersistentEntityStoreDb",{nO:(X.EntityStore={DF:1},X.EntityAssociationStore={DF:2},X),shared:!1,upgrade:function(c,V){V(1)&&g.I0(g.Ow(c,"EntityStore",{keyPath:"key"}),"entityType","entityType");V(2)&&(c=g.Ow(c,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.I0(c,"byParentEntityKey","parentEntityKey"),g.I0(c,"byChildEntityKey","childEntityKey"))},
version:3});return gX()},Dvp=function(X){return g.K$(C0A(),X)},SAi=function(X){return g.K$((0,g.Uur)(),X)},f6=function(X){this.token=X},p6=function(X,c){c=c===void 0?{}:c;
g.Dh.call(this,g.TyH[X],Object.assign({},{name:"PESEncoderError",type:X},c));this.type=X;this.level="WARNING";Object.setPrototypeOf(this,p6.prototype)},iNA=function(X){return new p6("WRONG_DATA_TYPE",{O4:X})},qAt=function(X){return X instanceof Error?new p6("UNKNOWN_ENCODE_ERROR",{zc:X.message}):new p6("UNKNOWN_ENCODE_ERROR")},XEG=function(X){return X instanceof Error?new p6("UNKNOWN_DECODE_ERROR",{zc:X.message}):new p6("UNKNOWN_DECODE_ERROR")},cSU=function(X,c){X=X instanceof p6?X:c(X);
g.IJ(X);throw X;},VFz=function(){},GnH=function(X,c,V){try{return X.U(c,V)}catch(G){cSU(G,qAt)}},nvU=function(X){X=(new TextEncoder).encode(X).subarray(0,16);
var c=new Uint8Array(16);c.set(X);return c},If=function(X){this.J=X},dBr=function(X){var c=Lnk[X];
if(c)return c;g.Ni(new g.Dh("Entity model not found.",{entityType:X}))},ySr=function(X,c){this.J=X;
this.G=c;this.U={}},ASA=function(X,c){a:{X=hHz(X.G,c.version);
try{var V=X.G(c.data,c.key);break a}catch(G){cSU(G,XEG)}V=void 0}return V},NW=function(X,c,V){return X.J.objectStore("EntityStore").get(c).then(function(G){if(G){if(V&&G.entityType!==V)throw Error("Incorrect entity type");
return ASA(X,G)}})},Us=function(X,c,V){return V?(V=V.map(function(G){return NW(X,G,c)}),g.eA.all(V)):X.J.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(c)).then(function(G){return G.map(function(n){return ASA(X,n)})})},u2=function(X,c,V){var G=stA(c),n=hHz(X.G,1),L=Object.assign({},c);
return X.J.objectStore("EntityStore").get(G).then(function(d){if(d){if(d.entityType!==V)throw Error("Incorrect entity type");L.entityMetadata||(d=ASA(X,d),L.entityMetadata=d.entityMetadata)}}).then(function(){var d={key:G,
entityType:V,data:GnH(n,L,G),version:1};return g.eA.all([g.gi(X.J.objectStore("EntityStore"),d),Yhk(X,L,V)])}).then(function(){Tc(X,G,V);
return G})},jop=function(X,c,V){c=c.map(function(G){return u2(X,G,V)});
return g.eA.all(c)},P_=function(X,c,V){if(V==null?0:V.VJ){var G=new Set;
return HeV(X,c,G).then(function(){for(var L=[],d=g.r(G),h=d.next();!h.done;h=d.next())L.push(P_(X,h.value));return g.eA.all(L).then(function(){})})}var n=g.jE(c).entityType;
return g.eA.all([X.J.objectStore("EntityStore").delete(c),aXh(X,c)]).then(function(){Tc(X,c,n)})},$Bp=function(X,c){return g.uE(X.J.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(c)},function(V){return g.eA.all([V.delete(),
aXh(X,V.cursor.primaryKey)]).then(function(){Tc(X,V.cursor.primaryKey,c);return g.Uw(V)})})},WnH=function(X,c,V,G){var n=hHz(X.G,1);
return NW(X,c,G).then(function(L){if(L){L=g.QN(L,V);var d={key:c,entityType:G,data:GnH(n,L,c),version:1};return g.eA.all([g.gi(X.J.objectStore("EntityStore"),d),Yhk(X,L,G)])}}).then(function(){Tc(X,c,G);
return c})},Tc=function(X,c,V){var G=X.U[V];
G||(G=new Set,X.U[V]=G);G.add(c)},wE_=function(X,c,V){var G=stA(c);
V=dBr(V);if(!V)return g.eA.resolve([]);V=new V(c);X=X.J.objectStore("EntityAssociationStore");c=[];V=g.r(V.G());for(var n=V.next();!n.done;n=V.next())c.push(g.gi(X,{parentEntityKey:G,childEntityKey:n.value}));return g.eA.all(c).then(function(L){return L.map(function(d){return d[1]})})},aXh=function(X,c){return X.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c))},Yhk=function(X,c,V){var G=stA(c);
return aXh(X,G).then(function(){return wE_(X,c,V)})},HeV=function(X,c,V){if(V.has(c))return g.eA.resolve(void 0);
V.add(c);return Fn7(X,c).then(function(G){return X.J.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(c)).then(function(){return G})}).then(function(G){var n=g.eA.resolve(void 0);
G=g.r(G);for(var L=G.next(),d={};!L.done;d={b$:void 0},L=G.next())d.b$=L.value,n=n.then(function(h){return function(){return HeV(X,h.b$,V)}}(d));
return n}).then(function(){})},Fn7=function(X,c){var V=X.J.objectStore("EntityAssociationStore");
return V.index("byParentEntityKey").getAll(IDBKeyRange.only(c)).then(function(G){var n=[];G=g.r(G);for(var L=G.next();!L.done;L=G.next())L=L.value,n.push(V.index("byChildEntityKey").getAll(L.childEntityKey));return g.eA.all(n)}).then(function(G){var n=[];
G=g.r(G);for(var L=G.next();!L.done;L=G.next())L=L.value,L.length===1&&n.push(L[0].childEntityKey);return n})},zc=function(){},Evh=function(){this.J={};
this.J[0]=new zc;if(!g.kP("aes_pes_encoder_killswitch")){var X=this.J;try{var c=g.SP();var V=nvU(c);var G=new If(new g.J6(V),new g.eE(V))}catch(n){throw X=n instanceof Error?new p6("KEY_CREATION_FAILED",{zc:n.message}):new p6("KEY_CREATION_FAILED"),g.IJ(X),X;}X[1]=G}},hHz=function(X,c){c=c===void 0?0:c;
X=X.J[c];if(!X)throw c=new p6("INVALID_ENCODER_VERSION",{O4:c}),g.IJ(c),c;return X},B_=function(X,c){g.I.call(this);
this.token=X;this.J=c;this.observers=[];X=new g.NL.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.SP());X.onmessage=this.G.bind(this);this.channel=X},K6=function(X,c,V){var G,n,L,d;
return g.O(function(h){if(h.J==1)return g.b(h,Dvp(X.token),2);if(h.J!=3)return G=h.G,g.b(h,g.M8(G,["EntityStore","EntityAssociationStore"],c,function(A){n=new ySr(A,X.J);return V(n)}),3);
L=h.G;n&&(d=n.U,Object.keys(d).length>0&&(X.channel.postMessage(d),rSr(X,d)));return h.return(L)})},C6=function(X,c,V){return K6(X,{mode:"readwrite",
SS:!0},function(G){return u2(G,c,V)})},Qo_=function(X,c){return K6(X,{mode:"readwrite",
SS:!0},function(V){return jop(V,c,"offlineOrchestrationActionWrapperEntity")})},ZeH=function(X,c){return K6(X,{mode:"readwrite",
SS:!0},function(V){return P_(V,c)})},xBr=function(X){return K6(X,{mode:"readwrite",
SS:!0},function(c){return $Bp(c,"videoPlaybackPositionEntity")})},Do=function(X,c,V){return K6(X,{mode:"readonly",
SS:!0},function(G){return NW(G,c,V)})},SJ=function(X,c,V){return K6(X,{mode:"readonly",
SS:!0},function(G){return Us(G,c,V)})},rSr=function(X,c){X=g.r(X.observers);
for(var V=X.next();!V.done;V=X.next())V=V.value,V(c)},vvp=function(){var X,c,V;
return g.O(function(G){if(G.J==1)return g.ZS(G,2),g.b(G,g.V5(),4);if(G.J!=2){X=G.G;if(!X||!g.i5()||typeof g.NL.BroadcastChannel==="undefined")return G.return();c=new Evh;return G.return(new B_(X,c))}V=g.k1(G);V instanceof Error&&g.IJ(V);return G.return()})},i2=function(){knM||(knM=vvp());
return knM},ovt=function(X){var c;
X=(c=X.options)==null?void 0:c.persistenceOption;return X==="ENTITY_PERSISTENCE_OPTION_PERSIST"||X==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},eHr=function(X){var c;
return g.O(function(V){return V.J==1?g.b(V,i2(),2):(c=V.G)?g.b(V,K6(c,"readwrite",function(G){for(var n={},L=g.r(X),d=L.next(),h={};!d.done;h={T7:void 0,Wa:void 0},d=L.next())h.T7=d.value,h.T7.entityKey&&ovt(h.T7)&&(h.Wa=g.kb(h.T7.payload),d=void 0,h.T7.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(d=function(A){return function(){return u2(G,A.T7.payload[A.Wa],A.Wa)}}(h)),h.T7.type==="ENTITY_MUTATION_TYPE_DELETE"&&(d=function(A){return function(){return P_(G,A.T7.entityKey)}}(h)),h.T7.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(d=function(A){return function(){return WnH(G,A.T7.entityKey,A.T7.payload[A.Wa],A.Wa)}}(h)),d&&(n[h.T7.entityKey]=n[h.T7.entityKey]?n[h.T7.entityKey].then(d):d()));
return g.eA.all(Object.values(n))}),0):V.return()})},JSM=function(X){var c;
return g.O(function(V){if(V.J==1){c=X.mutations;if(!c||c.length<=0)return V.return();if(g.cJ){var G={type:"ENTITY_LOADED"};c!==void 0&&(G.payload=c);g.cJ.dispatch(G)}return g.b(V,eHr(c),2)}c.length=0;g.Ql(V)})},mBG=function(X){return X!==void 0},RHp=function(X){var c=g.mf();
c=Object.assign({},c);X=Object.assign({},X);for(var V in c)X[V]?(c[V]!==4&&(c[V]=X[V]),delete X[V]):c[V]!==2&&(c[V]=4);Object.assign(c,X);g.LR1(c);JSON.stringify(c);return c},beM=function(X){var c,V;
return g.O(function(G){if(G.J==1)return g.b(G,g.V5(),2);if(G.J!=3)return(c=G.G)?g.b(G,g.t4(c),3):G.return();V=G.G;return G.return(g.M8(V,["index","media","captions"],{mode:"readwrite",SS:!0},function(n){var L=IDBKeyRange.bound(X+"|",X+"~");n=[n.objectStore("index").delete(L),n.objectStore("media").delete(L),n.objectStore("captions").delete(L)];return g.eA.all(n).then(function(){})}))})},tFA=function(){var X,c;
return g.O(function(V){if(V.J==1)return g.b(V,g.V5(),2);if(V.J!=3){X=V.G;if(!X)throw g.ku("rvdfd");return g.b(V,g.t4(X),3)}c=V.G;return V.return(g.M8(c,["index","media"],{mode:"readwrite",SS:!0},function(G){var n={};return g.N8(G.objectStore("index"),{},function(L){var d=L.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),h=g.eA.resolve(void 0);if(d){var A=d[1];d=d[2];n[A]=n[A]||{};var Y;n[A][d]=g.YRD((Y=L.getValue())==null?void 0:Y.fmts)}else h=L.delete().then(function(){});
return g.eA.all([g.Uw(L),h]).then(function(H){return g.r(H).next().value})}).then(function(){for(var L={},d=g.r(Object.keys(n)),h=d.next();!h.done;h=d.next()){h=h.value;
var A=n[h].v;L[h]=n[h].a&&A?1:2}var Y=RHp(L);return g.NIl(G.objectStore("media"),{},function(H){var a=H.cursor.key.match(g.$z1);a&&L[a[1]]||G.objectStore("media").delete(H.cursor.key);return g.bTD(H)}).then(function(){return Y})})}))})},Oek=function(X,c){var V,G;
return g.O(function(n){if(n.J==1)return g.b(n,g.V5(),2);if(n.J!=3){V=n.G;if(!V)throw g.ku("wct");return g.b(n,g.t4(V),3)}G=n.G;return g.b(n,g.M8(G,["captions"],{mode:"readwrite",SS:!0},function(L){var d=[];L=L.objectStore("captions");for(var h=0;h<c.length;h++){var A=g.gi(L,c[h],X+"|"+c[h].metadata.vss_id);d.push(A)}return g.eA.all(d)}),0)})},lXM=function(X){var c,V,G;
return g.O(function(n){if(n.J==1)return c=IDBKeyRange.bound(X+"|",X+"~"),g.b(n,g.V5(),2);if(n.J!=3){V=n.G;if(!V)throw g.ku("gactfv");return g.b(n,g.t4(V),3)}G=n.G;return n.return(G.getAll("captions",c))})},MFA=function(X){return g.O(function(c){g.bj(X,0);
return c.return(beM(X))})},gvH=function(X){return{context:g.ch(),
videoIds:X}},fXU=function(X){return{context:g.ch(),
playlistIds:X}},pEh=function(X){return{context:g.ch(),
offlinePlaylistSyncChecks:X}},IXi=function(){this.J=new Map},UBG=function(){NS_||(NS_=new IXi);
return NS_},TSH=function(X,c){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:X},metadata:c,statusCode:void 0,csn:void 0,can:void 0}},u5t=function(X,c,V){if(!V){var G=G===void 0?!1:G;
V=X.J.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!V||G)V=g.JI(16),X.J.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",V)}X={flowNonce:V,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:c.eventType};c.metadata&&(X.flowMetadata=c.metadata);c.statusCode!==void 0&&(X.flowEventStatus=c.statusCode);c.csn&&(X.csn=c.csn);c.can&&(X.can=c.can);g.H8("flowEvent",X,void 0)},PFr=function(X){var c,V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R;
return g.O(function(l){if(l.J==1)return g.b(l,K6(X,{mode:"readonly",SS:!0},function(p){return Us(p,"playbackData").then(function(cw){var Lj=cw.map(function(Fl){return Fl.transfer}).filter(function(Fl){return!!Fl}),ds=cw.map(function(Fl){return Fl.offlineVideoPolicy}).filter(function(Fl){return!!Fl}),M=cw.filter(function(Fl){return!!Fl.key}).map(function(Fl){return g.Hc(g.jE(Fl.key).entityId,"downloadStatusEntity")});
Lj=Us(p,"transfer",Lj);ds=Us(p,"offlineVideoPolicy",ds);M=Us(p,"downloadStatusEntity",M);var jD=Lj.then(function(Fl){Fl=Fl.reduce(function(As,ts){(ts==null?0:ts.offlineVideoStreams)&&As.push.apply(As,g.x(ts.offlineVideoStreams));return As},[]).filter(function(As){return!!As});
return Us(p,"offlineVideoStreams",Fl)});
return g.eA.all([Lj,ds,jD,M]).then(function(Fl){var As=g.r(Fl);Fl=As.next().value;var ts=As.next().value;var $U=As.next().value;As=As.next().value;return[cw,Fl,ts,$U,As]})})}),2);
if(l.J!=3)return c=l.G,g.b(l,K6(X,{mode:"readonly",SS:!0},function(p){return Us(p,"mainDownloadsListEntity").then(function(cw){var Lj,ds;return(ds=(Lj=cw[0])==null?void 0:Lj.downloads)!=null?ds:[]})}),3);
V=l.G;G=g.r(c);n=G.next().value;L=G.next().value;d=G.next().value;h=G.next().value;A=G.next().value;Y=n;H=L;a=d;W=h;w=A;F={};Z={};v={};e={};m={};t=[];f=g.r(H);for(U=f.next();!U.done;U=f.next())(C=U.value)&&(F[C.key]=C);K=g.r(a);for(nj=K.next();!nj.done;nj=K.next())(yl=nj.value)&&(Z[yl.key]=yl);Xl=g.r(w);for(u=Xl.next();!u.done;u=Xl.next())(q=u.value)&&(v[q.key]=q);Q=g.r(W);for(P=Q.next();!P.done;P=Q.next())(UD=P.value)&&(e[UD.key]=UD);Zi=g.r(V);for(ah=Zi.next();!ah.done;ah=Zi.next())Js=ah.value,SD=
void 0,m[(SD=Js.videoItem)!=null?SD:""]=!0,Js.videoItem&&(wM=Lt=void 0,k=(wM=(Lt=g.jE(Js.videoItem))==null?void 0:Lt.entityId)!=null?wM:"",t.push({externalVideoId:k}));J=Y.filter(function(p){if(!p||!p.key||!p.offlineVideoPolicy)return!1;p=g.jE(p.key).entityId;p=g.Hc(p,"downloadStatusEntity");var cw;return!(p&&((cw=v[p])==null?void 0:cw.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
R=J.map(function(p){var cw=F[p.transfer],Lj=[];if(cw==null?0:cw.offlineVideoStreams)for(var ds=g.r(cw.offlineVideoStreams),M=ds.next();!M.done;M=ds.next())(M=e[M.value])&&Lj.push(M);ds=Z[p.offlineVideoPolicy];M=m;var jD=p==null?void 0:p.playerResponseTimestamp,Fl=g.jE(ds.key).entityId;p=g.Hc(Fl,"mainVideoEntity");if(ds.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var As="OFFLINE_VIDEO_STATE_DISABLED";ds.expirationTimestamp&&Number(ds.expirationTimestamp)<Date.now()/1E3&&(As="OFFLINE_VIDEO_STATE_EXPIRED")}else if(ds.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")As="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(cw==null?void 0:cw.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":As="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":As="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":As="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":As="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":As="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":As="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:As="OFFLINE_VIDEO_STATE_UNKNOWN"}if(As==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(cw==null?void 0:cw.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":As="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":As="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":As=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}Fl={id:Fl,videoState:As};if(cw==null?0:cw.cotn)Fl.cotn=cw.cotn;if(cw==null?0:cw.maximumDownloadQuality)Fl.selectedVideoQuality=cw==null?void 0:cw.maximumDownloadQuality;if(cw==null?0:cw.lastProgressTimeMs)Fl.lastProgressTimeMs=cw.lastProgressTimeMs;jD&&(Fl.playerResponseSavedTimeMs=String(Number(jD)*1E3));cw=String;jD=0;Lj=g.r(Lj);for(As=Lj.next();!As.done;As=Lj.next())if(As=As.value,As.streamsProgress){As=g.r(As.streamsProgress);for(var ts=As.next();!ts.done;ts=
As.next()){var $U=void 0;jD+=Number(($U=ts.value.numBytesDownloaded)!=null?$U:0)}}Fl.downloadedBytes=cw(jD);Fl.selectedOfflineMode=M[p]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";ds.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(Fl.offlinePlaybackDisabledReason=ds.offlinePlaybackDisabledReason);return Fl});
return l.return({offlineVideos:R,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:t}}})})},zHp=function(){this.locks=navigator.locks},BSi=function(){try{var X=g.uO("ytglobal.locks_");
if(X)return X;var c;if(c=navigator){var V=navigator;c="locks"in V&&!!V.locks}if(c)return g.NL.localStorage&&g.NL.localStorage.getItem("noop"),X=new zHp,g.Tt("ytglobal.locks_",X),X}catch(G){}},qW=function(){},Knt=function(){},soG=function(X){if(X.includes(":"))throw Error("Invalid user cache name: "+X);
return X+":"+g.SP("CacheStorage get")},CF7=function(){return g.O(function(X){if(XL!==void 0)return X.return(XL);
XL=new Promise(function(c){var V;return g.O(function(G){switch(G.J){case 1:return g.ZS(G,2),g.b(G,c$.open("test-only"),4);case 4:return g.b(G,c$.delete("test-only"),5);case 5:g.vw(G,3);break;case 2:if(V=g.k1(G),V instanceof Error&&V.name==="SecurityError")return c(!1),G.return();case 3:c("caches"in window),g.Ql(G)}})});
return X.return(XL)})},ShV=function(){return g.O(function(X){if(X.J==1)return g.b(X,CF7(),2);
if(!X.G)return X.return(void 0);DBk||(DBk=new Knt);return X.return(DBk)})},V2=function(X,c,V){g.Ni(new g.Dh("Woffle: "+X,V?{cotn:V}:""));
c instanceof Error&&g.Ni(c)},iek=function(X){var c;
return g.O(function(V){if(V.J==1)return g.b(V,PFr(X),2);c=V.G;g.H8("offlineStateSnapshot",c);g.Ql(V)})},G6=function(X){g.I.call(this);
var c=this;this.api=X;this.F8={Th7:function(){return c.J},
RDK:function(){return c.G}};
typeof g.NL.BroadcastChannel!=="undefined"&&(this.J=new g.NL.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.SP()),this.J.onmessage=this.U.bind(this),this.G=new g.NL.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.SP()),this.G.onmessage=this.X.bind(this))},nV=function(X,c){X.api.z_("onOfflineOperationFailure",c);
var V;(V=X.J)==null||V.postMessage(c)},qhz=function(X,c,V,G){var n=this;
this.T=X;this.C=c;this.visibility=V;this.S=G;this.Z=this.D=this.B=this.U=this.J=!1;this.X=new g.i_(function(){n.S4()});
this.F8={NK:function(){return n.G},
S4:function(){n.S4()},
NiS:function(){return n.X}};
this.visibility.subscribe("visibilitystatechange",function(){n.U5()})},XI7=function(X){if(!X.U&&!X.J){var c=BSi();
if(c){X.U=!0;var V=g.SP("OfflineLockManager");c.request("woffle_orchestration_leader:"+V,{},function(){var G,n,L,d;return g.O(function(h){switch(h.J){case 1:return g.ZS(h,2),X.G=new g.Ei,X.J=!0,X.U=!1,g.b(h,X.T(),4);case 4:return g.b(h,X.G.promise,5);case 5:g.vw(h,0);break;case 2:G=g.k1(h),((L=(n=X).S)==null?0:L.call(n,"wo_relinquish_leadership_on_lock_request_error"))||X.S4(),G instanceof Error&&(d=G,d.args=[{name:"WoLockManagerError",Ci:G.name}],g.IJ(d)),g.Ql(h)}})})}}},ceG=function(X){X.J&&(X.Z=
!0,LV(X))},V8z=function(X,c){X.J&&(X.B=c,LV(X))},GSH=function(X,c){X.J&&(X.D=c,LV(X))},LV=function(X){X.D&&X.B&&X.Z&&X.visibility.isBackground()?g.qR(X.X,6E4):X.X.stop()},d5=function(X){var c;
X.offlineDeleteReason=(c=X.offlineDeleteReason)!=null?c:"OFFLINE_DELETE_REASON_UNKNOWN";var V;X.offlineModeType=(V=X.offlineModeType)!=null?V:"OFFLINE_NOW";g.H8("offlineDeleteEvent",X)},y2=function(X,c){var V=c.videoId;
var G=c.U2;c=c.offlineModeType;X.encryptedVideoId=V;X.cotn=G==null?void 0:G.cotn;X.offlineabilityFormatType=G==null?void 0:G.maximumDownloadQuality;var n;X.isRefresh=(n=G==null?void 0:G.isRefresh)!=null?n:!1;var L;X.softErrorCount=(L=G==null?void 0:G.transferRetryCount)!=null?L:0;X.offlineModeType=c!=null?c:"OFFLINE_NOW";(X.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&X.statusType==="UNKNOWN_STATUS_TYPE"||!X.transferStatusType&&!X.statusType)&&g.Ni(Error("Woffle unknown transfer status"));
g.H8("offlineTransferStatusChanged",X)},nQH=function(X,c,V,G){G={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!G};c&&V&&(c=Math.floor(c/1024).toFixed(),V=Math.floor(V/1024).toFixed(),G.alreadyDownloadedKbytes=c,G.totalFetchedKbytes=c,G.totalContentKbytes=V);y2(G,X)},Lht=function(X){y2({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},X)},dPA=function(X){switch(X){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
hg=function(X){var c,V,G;
return((G=(c=X.actionMetadata)==null?void 0:(V=c.retryScheduleIntervalsInSeconds)==null?void 0:V.length)!=null?G:0)>0},Ag=function(X){return X.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!X.entityKey},Yo=function(X){return X.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!X.entityKey},je=function(X){return X.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!X.entityKey},yep=function(X){return X.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!X.entityKey},
H$=function(X,c,V,G,n){n=n===void 0?!1:n;
var L,d,h,A,Y,H;return g.O(function(a){if(a.J==1)return L=g.Hc(X,c),d=g.Hc(X,"downloadStatusEntity"),g.b(a,K6(V,{mode:"readonly",SS:!0},function(W){return g.eA.all([NW(W,L,c),NW(W,d,"downloadStatusEntity")])}),2);
h=a.G;A=h.length?h[0]:void 0;if(!A)return a.Wl(0);Y=hUk;if(H=h.length>1?h[1]:void 0){if(H.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!n)return a.return();H.downloadState=G}else H={key:d,downloadState:G};g.z8(A,Y,H);return g.b(a,K6(V,{mode:"readwrite",SS:!0},function(W){return g.eA.all([u2(W,A,c),u2(W,H,"downloadStatusEntity")])}),0)})},a1=function(X,c){return X.actionType===c.actionType&&X.entityKey===c.entityKey},$o=function(X,c){if(X&&X.transferState!=="TRANSFER_STATE_COMPLETE"&&X.transferState!==
"TRANSFER_STATE_FAILED"){var V=g.jE(X.key).entityId;
y2({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:V,U2:X,offlineModeType:c})}},W$=function(X){if(!X||!X.thumbnails)return[];
var c=[];X=g.r(X.thumbnails);for(var V=X.next();!V.done;V=X.next())V=V.value,V.url&&c.push(V.url);return c},Aet=function(X,c,V){V=V===void 0?[]:V;
var G,n,L,d,h,A,Y,H,a,W,w,F,Z;return g.O(function(v){if(v.J==1)return V.length?g.b(v,SJ(X,c),2):v.return([]);G=v.G;n=new Set;L=g.r(G);for(d=L.next();!d.done;d=L.next())if(h=d.value,A=h.id||h.key)Y=g.jE(A).entityId,n.add(Y);H=[];a=g.r(V);for(W=a.next();!W.done;W=a.next())w=W.value,F=w.offlineVideoData,Z=void 0,((Z=F)==null?0:Z.videoId)&&!n.has(F.videoId)&&H.push(w);return v.return(H)})},YIi=function(X,c,V){return new g.Pp(X,{cotn:c,
raw_player_response:V,download_media:!0,start:Infinity,disable_watch_next:!0})},j5k=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},w5=function(X,c,V,G,n,L,d,h,A,Y,H){this.entityType=X;
this.actionId=c;this.action=V;this.parentActionId=G;this.rootActionId=n===void 0?c:n;this.childActionIds=L;this.prereqActionId=d;this.postreqActionIds=h;this.hasChildActionFailed=Y;this.retryScheduleIndex=0;this.J=H||Date.now();this.retryScheduleIndex=A||0},FL=function(X){if(!X.key)throw Error("Entity key is required.");
if(!X.actionProto)throw Error("OfflineOrchestrationAction is required.");var c=g.jE(X.key),V=g.jE(X.actionProto.entityKey);return new w5(V.entityType,c.entityId,X.actionProto,X.parentActionId,X.rootActionId,X.childActionIds,X.prereqActionId,X.postreqActionIds,X.retryScheduleIndex,X.hasChildActionFailed,Number(X.enqueueTimeSec)*1E3)},Ey=function(X){return{key:g.Hc(X.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:X.action,parentActionId:X.parentActionId,rootActionId:X.rootActionId,childActionIds:X.childActionIds,prereqActionId:X.prereqActionId,postreqActionIds:X.postreqActionIds,retryScheduleIndex:X.retryScheduleIndex,hasChildActionFailed:X.hasChildActionFailed,enqueueTimeSec:(X.J/1E3).toFixed()}},Hbz=function(){var X;
return g.O(function(c){return c.J==1?g.b(c,ShV(),2):(X=c.G)?c.return(X.delete("yt-player-local-img")):c.return(!0)})},r5=function(X){var c,V;
return g.O(function(G){if(G.J==1)return g.b(G,ShV(),2);if(G.J!=3){c=G.G;if(!c)throw Error("Cache API not supported");return X.length?g.b(G,c.open("yt-player-local-img"),3):G.return()}V=G.G;return g.b(G,Promise.all(X.map(function(n){return V.delete(n)})),0)})},Q2=function(X){var c,V;
return g.O(function(G){if(G.J==1)return g.b(G,ShV(),2);if(G.J!=3){c=G.G;if(!c)throw Error("Cache API not supported");return X.length?g.b(G,c.open("yt-player-local-img"),3):G.return()}V=G.G;return g.b(G,V.addAll(X),0)})},Zj=function(X,c,V,G,n){var L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD;
return g.O(function(Lt){switch(Lt.J){case 1:return L=g.Hc(X,"mainVideoEntity"),d=g.Hc(X,"ytMainChannelEntity"),h=g.Hc(X,"transfer"),A=g.Hc(X,"videoDownloadContextEntity"),g.b(Lt,K6(c,{mode:"readonly",SS:!0},function(wM){return g.eA.all([NW(wM,L,"mainVideoEntity"),NW(wM,d,"ytMainChannelEntity"),NW(wM,h,"transfer"),NW(wM,A,"videoDownloadContextEntity"),Us(wM,"ytMainChannelEntity"),Us(wM,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:Y=Lt.G;H=g.r(Y);a=H.next().value;W=H.next().value;w=H.next().value;F=H.next().value;Z=H.next().value;v=H.next().value;e=a;m=W;t=w;f=F;U=Z;C=v;if(!e&&!m){Lt.Wl(3);break}K=e?W$(e.thumbnail):[];if(!m){nj=[];Lt.Wl(4);break}return g.b(Lt,a0H(m,U),5);case 5:nj=Lt.G;case 4:return yl=nj,g.b(Lt,r5(K.concat(yl)),3);case 3:Xl=[];u=g.Hc(X,"downloadStatusEntity");q=g.r(C);for(Q=q.next();!Q.done;Q=q.next())P=Q.value,UD=g.jE(P.key).entityId,Zi=FL(P),ah=g.jE(Zi.action.entityKey).entityId,UD!==X&&ah!==X||a1(V,
P.actionProto)||Xl.push(P.key);return g.b(Lt,K6(c,{mode:"readwrite",SS:!0},function(wM){var k=Xl.map(function(J){return P_(wM,J)});
k.push(P_(wM,L,{VJ:!0}));k.push(P_(wM,u,{VJ:!0}));return g.eA.all(k)}),7);
case 7:SD=(Js=f)==null?void 0:Js.offlineModeType,n&&(d5(n),n.offlineModeType&&(SD=n.offlineModeType)),$o(t,SD),nV(G,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ql(Lt)}})},wIi=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R,l,p,cw,Lj,ds,M,jD,Fl,As,ts,$U,Ih,aR;
return g.O(function(zt){switch(zt.J){case 1:return n=g.Hc(X,"mainPlaylistEntity"),L=g.Hc(X,"ytMainChannelEntity"),g.b(zt,K6(c,{mode:"readonly",SS:!0},function(Nx){return g.eA.all([NW(Nx,n,"mainPlaylistEntity"),NW(Nx,L,"ytMainChannelEntity"),Us(Nx,"mainPlaylistEntity"),Us(Nx,"mainDownloadsListEntity"),Us(Nx,"ytMainChannelEntity"),Us(Nx,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:d=zt.G;h=g.r(d);A=h.next().value;Y=h.next().value;H=h.next().value;a=h.next().value;W=h.next().value;w=h.next().value;F=A;Z=Y;v=H;e=a;m=W;t=w;if(!F&&!Z){zt.Wl(3);break}f=F?$PM(F):[];if(!Z){U=[];zt.Wl(4);break}return g.b(zt,a0H(Z,m),5);case 5:U=zt.G;case 4:return C=U,g.b(zt,r5(f.concat(C)),3);case 3:K=[];nj=new Map;if(!F){zt.Wl(7);break}return g.b(zt,Wh7(F,v,e),8);case 8:K=zt.G;yl=g.r(K);for(Xl=yl.next();!Xl.done;Xl=yl.next())u=Xl.value,nj.set(u,{videoId:u,playlistId:X,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.b(zt,K6(c,{mode:"readonly",SS:!0},function(Nx){return g.eA.all([Us(Nx,"transfer"),Us(Nx,"videoDownloadContextEntity")])}),9);
case 9:q=zt.G;Q=g.r(q);P=Q.next().value;UD=Q.next().value;Zi=P;ah=UD;Js=g.r(Zi);for(SD=Js.next();!SD.done;SD=Js.next())Lt=SD.value,wM=g.jE(Lt.key).entityId,(k=nj.get(wM))&&Lt&&(k.cotn=Lt.cotn);J=g.r(ah);for(R=J.next();!R.done;R=J.next())l=R.value,p=g.jE(l.key).entityId,(cw=nj.get(p))&&l&&(cw.offlineModeType=l.offlineModeType);case 7:Lj=[];ds=g.r(t);for(M=ds.next();!M.done;M=ds.next())jD=M.value,Fl=g.jE(jD.key).entityId,As=FL(jD),Fl!==X&&As.rootActionId!==X||a1(V,jD.actionProto)||Lj.push(jD.key);ts=
g.Hc(X,"mainPlaylistEntity");return g.b(zt,K6(c,{mode:"readwrite",SS:!0},function(Nx){var hi=Lj.map(function(O5){return P_(Nx,O5)});
hi.push(P_(Nx,ts,{VJ:!0}));return g.eA.all(hi)}),10);
case 10:if(!F){zt.Wl(0);break}K.reverse();if(!K){zt.Wl(0);break}$U=g.r(K);Ih=$U.next();case 13:if(Ih.done){zt.Wl(0);break}aR=Ih.value;return g.b(zt,Zj(aR,c,V,G,nj.get(aR)),14);case 14:Ih=$U.next(),zt.Wl(13)}})},EQ_=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W;
return g.O(function(w){if(w.J==1)return n=g.Hc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),L=new Map,g.b(w,K6(X,{mode:"readwrite",SS:!0},function(F){var Z=Us(F,"transfer"),v=Us(F,"offlineOrchestrationActionWrapperEntity"),e=Us(F,"videoDownloadContextEntity"),m=NW(F,n,"mainDownloadsListEntity");return g.eA.all([Z,v,e,m]).then(function(t){t=g.r(t);var f=t.next().value;var U=t.next().value;var C=t.next().value;var K=t.next().value;t=Fhk.map(function(yl){return $Bp(F,yl)});
U=g.r(U);for(var nj=U.next();!nj.done;nj=U.next())nj=nj.value,a1(c,nj.actionProto)||t.push(P_(F,nj.key,{VJ:!0}));K&&(K.downloads=[],t.push(u2(F,K,"mainDownloadsListEntity")));if(C)for(C=g.r(C),K=C.next();!K.done;K=C.next())K=K.value,U=g.jE(K.key).entityId,U=g.Hc(U,"transfer"),L.set(U,K.offlineModeType);return g.eA.all(t).then(function(){return f})})}),2);
d=w.G;h=g.r(d);for(A=h.next();!A.done;A=h.next())Y=A.value,$o(Y,L.get(Y.key)),H=g.jE(Y.key).entityId,a={videoId:H,offlineDeleteReason:G,cotn:Y.cotn,offlineModeType:L.get(Y.key)},d5(a),W=g.Hc(H,"mainVideoEntity"),nV(V,{entityKey:W,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.b(w,Hbz(),0)})},$PM=function(X,c){var V=[];
if(X.thumbnailStyleData){X=g.r(X.thumbnailStyleData);for(var G=X.next();!G.done;G=X.next()){var n=void 0,L=void 0,d=void 0;V=V.concat(W$((n=G.value)==null?void 0:(L=n.value)==null?void 0:(d=L.collageThumbnail)==null?void 0:d.coverThumbnail))}}c=W$(c);return V.concat(c)},Wh7=function(X,c,V){var G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl;
return g.O(function(Xl){G=[];n=new Set;if(V.length)for(L=g.r(V),d=L.next();!d.done;d=L.next())if(h=d.value,A=void 0,(A=h.downloads)==null?0:A.length)for(Y=g.r(h.downloads),H=Y.next();!H.done;H=Y.next())a=H.value,a.videoItem&&(W=g.jE(a.videoItem).entityId,n.add(W));if(X.videos){w=g.r(X.videos);for(F=w.next();!F.done;F=w.next())Z=F.value,v=JSON.parse(g.jE(Z).entityId),v.videoId&&!n.has(v.videoId)&&G.push(v.videoId);e=g.r(c);for(m=e.next();!m.done;m=e.next())if(t=m.value,t.key!==X.key&&(f=t.videos))for(U=
g.r(f),C=U.next();!C.done;C=U.next())K=C.value,nj=JSON.parse(g.jE(K).entityId),nj.videoId&&(yl=G.indexOf(nj.videoId),yl!==-1&&G.splice(yl,1))}return Xl.return(G)})},a0H=function(X,c){var V,G,n,L,d,h,A,Y;
return g.O(function(H){V=W$(X.avatar);G=g.r(c);for(n=G.next();!n.done;n=G.next())if(L=n.value,L.id!==X.id)for(d=g.r(W$(L.avatar)),h=d.next();!h.done;h=d.next())A=h.value,Y=V.indexOf(A),Y!==-1&&V.splice(Y,1);return H.return(V)})},rez=function(X){var c;
return g.O(function(V){c=g.T(X.frameworkUpdates,xo);return X.frameworkUpdates&&c?g.b(V,JSM(c),0):V.return()})},Zbr=function(X){var c;
if((c=X.onResponseReceivedActions)!=null&&c.length){var V;X=(V=g.T(g.T(X.onResponseReceivedActions[0],Q5M),g.fRU))==null?void 0:V.actions;if(X!=null&&X.length)return X}},xPU=function(X){var c,V,G;
return g.O(function(n){if(n.J==1)return X?g.b(n,Do(X,g.tJ,"mainDownloadsListEntity"),2):n.return([]);c=n.G;return((V=c)==null?0:(G=V.downloads)==null?0:G.length)?n.return(c.downloads.map(function(L){var d;return(d=L.videoItem)!=null?d:""})):n.return([])})},kSA=function(X,c){var V;
return g.O(function(G){return G.J==1?g.b(G,vQh(X,c),2):(V=G.G)?g.b(G,K6(X,{mode:"readwrite",SS:!0},function(n){var L=[u2(n,V.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];V.mainDownloadsListEntity&&L.push(u2(n,V.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.eA.all(L)}),0):G.Wl(0)})},vQh=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t;
return g.O(function(f){if(f.J==1)return V=g.Hc("main_downloads_library_id","mainDownloadsLibraryEntity"),G=g.Hc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.b(f,K6(X,{mode:"readonly",SS:!0},function(U){return g.eA.all([NW(U,V,"mainDownloadsLibraryEntity"),NW(U,G,"mainDownloadsListEntity")])}),2);
n=f.G;L=g.r(n);d=L.next().value;h=L.next().value;A=d;Y=h;A||(A={id:V});H=g.r(c);for(a=H.next();!a.done;a=H.next())if(W=a.value,W===g.tJ){if(A.smartDownloadsList)return f.return();A.smartDownloadsList=W}else if(w=g.jE(W).entityType,F={},w==="mainPlaylistEntity"?F.playlistItem=W:w==="mainVideoEntity"&&(F.videoItem=W),!g.bU(F)){Z=void 0;if((Z=Y)==null?0:Z.downloads){v=!1;e=g.r(Y.downloads);for(m=e.next();!m.done;m=e.next())if(t=m.value,t.playlistItem===W||t.videoItem===W){v=!0;break}v||Y.downloads.push(F)}else Y=
{id:G,downloads:[F]};A.downloadsList=G}return f.return({mainDownloadsLibraryEntity:A,mainDownloadsListEntity:Y})})},oQU=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v;
return g.O(function(e){if(e.J==1)return V=g.Hc("main_downloads_library_id","mainDownloadsLibraryEntity"),G=g.Hc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.b(e,K6(X,{mode:"readonly",SS:!0},function(m){return g.eA.all([NW(m,V,"mainDownloadsLibraryEntity"),NW(m,G,"mainDownloadsListEntity"),NW(m,g.tJ,"mainDownloadsListEntity")])}),2);
n=e.G;L=g.r(n);d=L.next().value;h=L.next().value;A=L.next().value;Y=d;H=h;a=A;if(!Y)return e.Wl(0);if(c===g.tJ&&((W=a)==null?0:W.downloads))a.downloads=[];else if((w=H)==null?0:w.downloads)for(F=g.jE(c).entityType,Z=0;Z<H.downloads.length;Z++)if(v=H.downloads[Z],F==="mainVideoEntity"&&v.videoItem===c){H.downloads.splice(Z,1);break}else if(F==="mainPlaylistEntity"&&v.playlistItem===c){H.downloads.splice(Z,1);break}return g.b(e,K6(X,{mode:"readwrite",SS:!0},function(m){var t=[u2(m,Y,"mainDownloadsLibraryEntity")];
H&&t.push(u2(m,H,"mainDownloadsListEntity"));a&&t.push(u2(m,a,"mainDownloadsListEntity"));return g.eA.all(t)}),0)})},v$=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W;
return g.O(function(w){if(w.J==1)return V=g.Hc(c,"transfer"),G=g.Hc(c,"videoDownloadContextEntity"),g.b(w,K6(X,{mode:"readonly",SS:!0},function(F){return g.eA.all([NW(F,V,"transfer"),NW(F,G,"videoDownloadContextEntity")])}),2);
n=w.G;L=g.r(n);d=L.next().value;h=L.next().value;A=d;Y=h;W={videoId:c,cotn:(H=A)==null?void 0:H.cotn,offlineModeType:(a=Y)==null?void 0:a.offlineModeType};return w.return(W)})},ko=function(X,c,V,G,n){var L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj;
return g.O(function(yl){switch(yl.J){case 1:return L=g.Hc(X,"musicTrack"),d=g.Hc(X,"transfer"),g.b(yl,K6(c,{mode:"readonly",SS:!0},function(Xl){return g.eA.all([NW(Xl,L,"musicTrack"),NW(Xl,d,"transfer"),Us(Xl,"musicTrack"),Us(Xl,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=yl.G;A=g.r(h);Y=A.next().value;H=A.next().value;a=A.next().value;W=A.next().value;w=Y;F=H;Z=a;v=W;if(!w){yl.Wl(3);break}return g.b(yl,eUV(w,Z),4);case 4:return e=yl.G,g.b(yl,r5(e),3);case 3:m=[];t=g.r(v);for(f=t.next();!f.done;f=t.next())U=f.value,C=g.jE(U.key).entityId,K=FL(U),nj=g.jE(K.action.entityKey).entityId,C!==X&&nj!==X||a1(V,U.actionProto)||m.push(U.key);return g.b(yl,K6(c,{mode:"readwrite",SS:!0},function(Xl){var u=m.map(function(q){return P_(Xl,q)});
u.push(P_(Xl,L,{VJ:!0}));return g.eA.all(u)}),6);
case 6:$o(F),n&&d5(n),nV(G,{entityKey:L,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Ql(yl)}})},o1=function(X,c,V,G,n){var L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R;
return g.O(function(l){switch(l.J){case 1:return L=g.Hc(X,c),d=g.Hc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(l,K6(V,{mode:"readonly",SS:!0},function(p){return g.eA.all([NW(p,L,c),NW(p,d,"musicDownloadsLibraryEntity"),Us(p,c),Us(p,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:h=l.G;A=g.r(h);Y=A.next().value;H=A.next().value;a=A.next().value;W=A.next().value;w=Y;F=H;Z=a;v=W;if(!w){l.Wl(3);break}return g.b(l,eUV(w,Z),4);case 4:return e=l.G,g.b(l,r5(e),3);case 3:m=[];t=new Map;if(!w){l.Wl(6);break}return g.b(l,Jei(w,Z,F),7);case 7:m=l.G;f=g.r(m);for(U=f.next();!U.done;U=f.next())C=U.value,K=g.jE(C).entityId,t.set(K,{videoId:K,playlistId:X,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.b(l,SJ(V,"transfer"),8);case 8:for(nj=l.G,yl=g.r(nj),
Xl=yl.next();!Xl.done;Xl=yl.next())u=Xl.value,q=g.jE(u.key).entityId,(Q=t.get(q))&&u&&(Q.cotn=u.cotn);case 6:P=[];UD=g.r(v);for(Zi=UD.next();!Zi.done;Zi=UD.next())ah=Zi.value,Js=g.jE(ah.key).entityId,SD=FL(ah),Js!==X&&SD.rootActionId!==X||a1(G,ah.actionProto)||P.push(ah.key);Lt=g.Hc(X,c);return g.b(l,K6(V,{mode:"readwrite",SS:!0},function(p){var cw=P.map(function(Lj){return P_(p,Lj)});
cw.push(P_(p,Lt,{VJ:!0}));return g.eA.all(cw)}),9);
case 9:if(!w){l.Wl(0);break}m.reverse();if(!m.length){l.Wl(0);break}wM=g.r(m);k=wM.next();case 12:if(k.done){l.Wl(0);break}J=k.value;R=g.jE(J).entityId;if(!R){l.Wl(13);break}return g.b(l,ko(R,V,G,n,t.get(R)),13);case 13:k=wM.next(),l.Wl(12)}})},ee=function(X,c,V){var G,n,L,d,h,A,Y;
return g.O(function(H){if(H.J==1)return g.b(H,K6(X,{mode:"readwrite",SS:!0},function(a){var W=Us(a,"transfer"),w=Us(a,"offlineOrchestrationActionWrapperEntity");return g.eA.all([W,w]).then(function(F){F=g.r(F);var Z=F.next().value;var v=F.next().value;F=mPU.map(function(f){return $Bp(a,f)});
v=g.r(v);for(var e=v.next();!e.done;e=v.next()){e=e.value;var m=g.jE(e.actionProto.entityKey).entityType==="musicTrack",t=e.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";a1(c,e.actionProto)||m&&(!m||t)||F.push(P_(a,e.key,{VJ:!0}))}return g.eA.all(F).then(function(){return Z})})}),2);
G=H.G;n=g.r(G);for(L=n.next();!L.done;L=n.next())d=L.value,$o(d),h=g.jE(d.key).entityId,A={videoId:h,offlineDeleteReason:void 0,cotn:d.cotn},d5(A),Y=g.Hc(h,"musicTrack"),nV(V,{entityKey:Y,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.b(H,Hbz(),0)})},RUp=function(X){for(var c,V=g.r(X.additionalMetadatas),G=V.next();!G.done;G=V.next())G=G.value,G.offlineMusicVideoData&&(c=G.offlineMusicVideoData);
var n,L,d,h,A;return{id:g.Hc(X.videoId,"musicTrack"),videoId:X.videoId,title:X.title,thumbnailDetails:X.thumbnail,lengthMs:String(Number(X.lengthSeconds)*1E3),albumTitle:(n=c)==null?void 0:n.releaseTitle,musicVideoType:(L=c)==null?void 0:L.musicVideoType,contentRating:{explicitType:(d=c)==null?void 0:d.explicitType},artistNames:((h=c)==null?void 0:h.byline)||((A=c)==null?void 0:A.channelName),downloadMetadata:g.Hc(X.videoId,"musicTrackDownloadMetadataEntity")}},Jei=function(X,c,V){var G,n,L,d,h,A,
Y,H,a,W,w,F,Z,v,e,m,t,f;
return g.O(function(U){G=[];n=new Set;if((L=V)==null?0:(d=L.downloadedTracks)==null?0:d.length)for(h=g.r(V.downloadedTracks),A=h.next();!A.done;A=h.next())Y=A.value,n.add(Y);if(X.tracks){H=g.r(X.tracks);for(a=H.next();!a.done;a=H.next())W=a.value,n.has(W)||G.push(W);w=g.r(c);for(F=w.next();!F.done;F=w.next())if(Z=F.value,Z.id!==X.id&&(v=Z.tracks))for(e=g.r(v),m=e.next();!m.done;m=e.next())t=m.value,f=G.indexOf(t),f!==-1&&G.splice(f,1)}return U.return(G)})},eUV=function(X,c){var V,G,n,L,d,h,A,Y;
return g.O(function(H){V=W$(X.thumbnailDetails);G=g.r(c);for(n=G.next();!n.done;n=G.next())if(L=n.value,L.id!==X.id)for(d=g.r(W$(L.thumbnailDetails)),h=d.next();!h.done;h=d.next())A=h.value,Y=V.indexOf(A),Y!==-1&&V.splice(Y,1);return H.return(V)})},bb7=function(X,c){var V,G,n,L,d,h,A,Y,H;
return g.O(function(a){if(a.J==1)return V=g.Hc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(a,Do(X,V,"musicDownloadsLibraryEntity"),2);(G=a.G)||(G={id:V});n=g.jE(c).entityType;n==="musicTrack"?(L=G.downloadedTracks)!=null&&L.includes(c)||(G.downloadedTracks=((d=G.downloadedTracks)!=null?d:[]).concat(c)):n==="musicPlaylist"?(h=G.downloadedPlaylists)!=null&&h.includes(c)||(G.downloadedPlaylists=((A=G.downloadedPlaylists)!=null?A:[]).concat(c)):n!=="musicAlbumRelease"||(Y=G.downloadedAlbumReleases)!=
null&&Y.includes(c)||(G.downloadedAlbumReleases=((H=G.downloadedAlbumReleases)!=null?H:[]).concat(c));return g.b(a,C6(X,G,"musicDownloadsLibraryEntity"),0)})},t8r=function(X,c){var V,G,n,L,d,h,A;
return g.O(function(Y){if(Y.J==1)return V=g.Hc("music_downloads_library_id","musicDownloadsLibraryEntity"),g.b(Y,Do(X,V,"musicDownloadsLibraryEntity"),2);G=Y.G;if(!G)return Y.Wl(0);n=g.jE(c).entityType;n==="musicTrack"?L=G.downloadedTracks:n==="musicPlaylist"&&(L=G.downloadedPlaylists);if((d=L)==null?0:d.length)for(h=0;h<L.length;h++)if(A=L[h],A===c){L.splice(h,1);break}return g.b(Y,C6(X,G,"musicDownloadsLibraryEntity"),0)})},Obi=function(X){var c=X.videos;
X=[];var V=[];if(c){c=g.r(c);for(var G=c.next();!G.done;G=c.next()){var n=G.value.offlineVideoData.videoId;G=g.Hc(n,"musicTrack");n=g.Hc(n,"musicTrackDownloadMetadataEntity");X.push(G);V.push(n)}}return{Qy:X,tG:V}},Jg=function(X,c,V){c={track:RUp(c)};
V&&(c.playlistId=V);if(X=g.T(X.actionMetadata,l0r))c.maximumDownloadQuality=X.maximumDownloadQuality;return{musicTrackEntityActionMetadata:c}},gQH=function(X){var c,V,G,n,L,d,h,A;
return g.O(function(Y){switch(Y.J){case 1:return c=g.AX(),V=gvH(X),G=g.nn(M8H),g.ZS(Y,2),L={Rz:!0},g.b(Y,g.qp(c,V,G,void 0,L),4);case 4:n=Y.G;g.vw(Y,3);break;case 2:d=g.k1(Y);if(d instanceof g.DN)throw h="GetOffline network manager error: "+d.message,V2(h,d),Error(h);V2("GetOffline fetch request error",d);throw Error("GetOffline fetch request error");case 3:A=mO(n);if(!n)throw V2("Network request failed"),Error("Network request failed");if(A!==void 0)R1(A);else if(!n.videos||!n.videos.length)throw V2("No data"),
Error("No data");return Y.return(n.videos.map(function(H){return H.offlineVideoData}))}})},f0_=function(X){var c,V,G,n,L,d,h,A;
return g.O(function(Y){switch(Y.J){case 1:return c=g.AX(),V=fXU(X),G=g.nn(M8H),g.ZS(Y,2),L={Rz:!0},g.b(Y,g.qp(c,V,G,void 0,L),4);case 4:n=Y.G;g.vw(Y,3);break;case 2:d=g.k1(Y);if(d instanceof g.DN)throw h="GetOffline network manager error for playlist: "+d.message,V2(h,d),Error(h);V2("GetOffline fetch request error for playlist",d);throw Error("GetOffline fetch request error for playlist");case 3:A=mO(n);if(!n)throw V2("Network request failed for playlist"),Error("Network request failed for playlist");
if(A!==void 0)R1(A,"playlist");else if(!n.playlists||!n.playlists.length)throw V2("No data for playlist"),Error("No data for playlist");return Y.return(n.playlists.map(function(H){return H.offlinePlaylistData}))}})},I0V=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah;
return g.O(function(Js){switch(Js.J){case 1:return g.b(Js,i2(),2);case 2:n=Js.G;if(!n)return Js.return([]);L=[];if((d=G)==null?0:d.length){L=G;Js.Wl(3);break}return g.b(Js,SJ(n,"mainPlaylistEntity"),4);case 4:L=Js.G;case 3:if(!L.length)return Js.return([]);h=[];A=Date.now()/1E3;Y=g.r(L);H=Y.next();case 5:if(H.done)return h.length?g.b(Js,pIU(h),10):Js.return([]);a=H.value;if(!a.downloadState){W=void 0;Js.Wl(8);break}return g.b(Js,Do(n,a.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:W=
Js.G;case 8:w=W;F=void 0;v=(Z=(F=a)==null?void 0:F.entityMetadata)&&Z.nextAutoRefreshIntervalSeconds?Number(Z.nextAutoRefreshIntervalSeconds):NaN;e=Number.isNaN(v)?X:v;t=m=void 0;f=((m=w)==null?0:m.lastSyncedTimestampMillis)?Number((t=w)==null?void 0:t.lastSyncedTimestampMillis)/1E3:0;C=U=void 0;K=((U=w)==null?0:U.addedTimestampMillis)?Number((C=w)==null?void 0:C.addedTimestampMillis)/1E3:0;if(V||!Z||f+e<=A){nj=[];yl=void 0;if((yl=a.videos)==null?0:yl.length)for(Xl=g.r(a.videos),u=Xl.next();!u.done;u=
Xl.next())q=u.value,Q=JSON.parse(g.jE(q).entityId),Q.videoId&&nj.push(Q.videoId);P="0";Z&&(UD=void 0,P=String(Number((UD=Z.offlineLastModifiedTimestampSeconds)!=null?UD:0).toFixed()));Zi={playlistId:a.playlistId,videoIds:nj,offlineLastModifiedTimestamp:P,autoSync:c,offlineDateAddedTimestamp:String(K.toFixed())};h.push(Zi)}H=Y.next();Js.Wl(5);break;case 10:return ah=Js.G,Js.return(ah)}})},NzM=function(){var X,c,V,G,n;
return g.O(function(L){if(L.J==1)return g.b(L,i2(),2);if(L.J!=3)return(X=L.G)?g.b(L,SJ(X,"refresh"),3):L.return(!1);c=L.G;if((V=c[0])==null||!V.refreshTime)return L.return(!1);G=Number(c[0].refreshTime);n=Date.now()/1E3;return L.return(isFinite(G)&&n>=G)})},TzM=function(X,c){var V,G,n;
return g.O(function(L){switch(L.J){case 1:return g.ZS(L,2),g.b(L,UP7(X,c),4);case 4:return G=L.G,g.b(L,rez(G),5);case 5:V=Zbr(G);g.vw(L,3);break;case 2:n=g.k1(L),V2("getAndProcessSmartDownloadsResponse request or processing error",n);case 3:return L.return(V)}})},uGG=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah;
return g.O(function(Js){switch(Js.J){case 1:return g.b(Js,i2(),2);case 2:n=Js.G;if(!n)return Js.return([]);L=[];if((d=G)==null?0:d.length){L=G;Js.Wl(3);break}return g.b(Js,SJ(n,"musicPlaylist"),4);case 4:L=Js.G;case 3:if(!L.length)return Js.return([]);h=[];A=Date.now()/1E3;Y=g.r(L);H=Y.next();case 5:if(H.done)return h.length?g.b(Js,pIU(h),10):Js.return([]);a=H.value;W=void 0;F=(w=(W=a)==null?void 0:W.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;Z=
Number.isNaN(F)?X:F;e=v=0;m="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!a.downloadMetadata){Js.Wl(8);break}return g.b(Js,Do(n,a.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:t=Js.G,U=f=void 0,v=Number((U=(f=t)==null?void 0:f.addedTimestampMillis)!=null?U:"0")/1E3,K=C=void 0,e=Number((K=(C=t)==null?void 0:C.lastModifiedTimestampMillis)!=null?K:"0")/1E3,yl=nj=void 0,m=(yl=(nj=t)==null?void 0:nj.syncState)!=null?yl:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Xl=void 0;if(V||m!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!w||Number((Xl=w.lastSyncedTimestampSeconds)!=null?Xl:0)+Z<=A){u=[];q=void 0;if((q=a.tracks)==null?0:q.length)for(Q=g.r(a.tracks),P=Q.next();!P.done;P=Q.next())UD=P.value,u.push(g.jE(UD).entityId);Zi={playlistId:a.playlistId,videoIds:u,offlineLastModifiedTimestamp:String(e.toFixed()),autoSync:c,offlineDateAddedTimestamp:String(v.toFixed())};h.push(Zi)}H=Y.next();Js.Wl(5);break;case 10:return ah=Js.G,Js.return(ah)}})},UP7=function(X,c){var V,G,n,L,d,h,A,Y,H,a;
return g.O(function(W){switch(W.J){case 1:return V=g.AX(),g.b(W,i2(),2);case 2:G=W.G;if(!G){W.Wl(3);break}return g.b(W,PFr(G),4);case 4:n=W.G;case 3:var w=n;L={context:g.ch(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:X},offlineClientState:w,clientStateRequestData:{preferredFormatType:c}}}};d=g.nn(Pv_);g.ZS(W,5);A={Rz:!0};return g.b(W,g.qp(V,L,d,void 0,A),7);case 7:h=W.G;g.vw(W,6);break;case 5:Y=g.k1(W);if(Y instanceof g.DN)throw H=
"DPS network manager error for smart downloads: "+Y.message,V2(H,Y),Error(H);V2("DPS fetch request error for smart downloads",Y);throw Error("DPS fetch request error for smart downloads");case 6:a=mO(h);if(h)a!==void 0&&R1(a,"smart downloads");else throw V2("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return W.return(h)}})},Bzp=function(X,c){var V,G,n,L,d,h,A,Y;
return g.O(function(H){switch(H.J){case 1:return V=g.AX(),G={context:g.ch(),videoPlaybackPositionEntities:X,lastSyncTimestampUsec:c},n=g.nn(zUr),g.ZS(H,2),d={Rz:!0},g.b(H,g.qp(V,G,n,void 0,d),4);case 4:L=H.G;g.vw(H,3);break;case 2:h=g.k1(H);if(h instanceof g.DN)throw A="VPPS network manager error: "+h.message,V2(A,h),Error(A);V2("VPPS fetch request error",h);throw Error("VPPS fetch request error");case 3:Y=mO(L);if(L)Y!==void 0&&R1(Y,"position sync");else throw V2("Network request failed for position sync"),
Error("Network request failed for position sync");return H.return(L)}})},s5V=function(X,c,V){var G,n,L,d,h,A,Y,H;
return g.O(function(a){switch(a.J){case 1:G=g.AX();var W=V.refreshData,w=V.isEnqueuedForExpiredStreamUrlRefetch,F=V.qy,Z=V.offlineSourceData,v=V.mediaCapabilities,e={entityKey:X};W&&(e.refreshData=W);w&&(e.isExpiredStreamUrlRefetch=w);F&&(e.downloadParameters=F);Z&&(e.offlineSourceData=Z);W={context:g.n9(c),signatureTimestamp:20158,videos:[e]};v&&(W.mediaCapabilities=v);n=W;L=g.nn(KhU);g.ZS(a,2);h={Rz:!0};return g.b(a,g.qp(G,n,L,void 0,h),4);case 4:d=a.G;g.vw(a,3);break;case 2:A=g.k1(a);if(A instanceof
g.DN)throw Y="GetPDE network manager error: "+A.message,V2(Y,A),Error(Y);V2("GetPDE fetch request error",A);throw Error("GetPDE fetch request error");case 3:H=mO(d);if(d)H!==void 0&&R1(H,"PDE");else throw V2("Network request failed for PDE"),Error("Network request failed for PDE");return a.return(d)}})},mO=function(X){var c;
return(c=X.errorMetadata)==null?void 0:c.status},R1=function(X,c){c=c?" for "+c:"";
if(X===0)throw X="Empty response body"+c,V2(X),Error(X);X="Response with error"+c;V2(X);throw Error(X);},pIU=function(X){var c,V,G,n,L,d,h,A;
return g.O(function(Y){switch(Y.J){case 1:return c=g.AX(),V=pEh(X),G=g.nn(CvA),g.ZS(Y,2),L={Rz:!0},g.b(Y,g.qp(c,V,G,void 0,L),4);case 4:n=Y.G;g.vw(Y,3);break;case 2:d=g.k1(Y);if(d instanceof g.DN)throw h="offlinePlaylistSyncCheck network manager error: "+d.message,V2(h,d),Error(h);V2("offlinePlaylistSyncCheck fetch request error",d);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:A=mO(n);if(!n)throw V2("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(A!==void 0)R1(A,"playlist sync");else if(!n.offlinePlaylistSyncCheckDatas||!n.offlinePlaylistSyncCheckDatas.length)throw V2("No data for playlist sync"),Error("No data for playlist sync");return Y.return(n.offlinePlaylistSyncCheckDatas.map(function(H){return H.offlinePlaylistSyncCheckData}))}})},bD=function(X){this.J=X},DPi=function(X,c){var V,G,n,L,d,h;
return g.O(function(A){switch(A.J){case 1:V=new Map,G=g.r(c),n=G.next();case 2:if(n.done){A.Wl(4);break}L=n.value;d=V;h=d.set;return g.b(A,X.G(L),5);case 5:h.call(d,L,A.G);n=G.next();A.Wl(2);break;case 4:return A.return(V)}})},tg=function(X,c,V,G,n,L){c=g.Hc(c,V);
G=Object.assign({},L,{priority:G,retryScheduleIntervalsInSeconds:n});return{actionType:X,entityKey:c,actionMetadata:G}},Oy=function(X,c,V,G,n,L){this.status=X;
this.J=c;this.X=V;this.G=G;this.U=n;this.downloadState=L},SI7=function(X,c,V){this.J=X;
this.qW=c;this.U=V},XLz=function(X,c){var V,G,n,L,d,h,A,Y,H;
return g.O(function(a){switch(a.J){case 1:return V=c.entityKey,n=(G=g.T(c.actionMetadata,lD))==null?void 0:G.isEnqueuedForExpiredStreamUrlRefetch,g.ZS(a,2),L=void 0,g.b(a,ibV(X,c),4);case 4:L=a.G;g.ZS(a,5);var W=(W=g.T(c.actionMetadata,lD))?{maximumDownloadQuality:W.maximumDownloadQuality}:void 0;return g.b(a,s5V(V,X.qW,{isEnqueuedForExpiredStreamUrlRefetch:n,qy:W,offlineSourceData:L}),7);case 7:d=a.G;g.vw(a,6,2);break;case 5:return g.k1(a,2),h=hg(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",V2("PDE handleAdd error"),a.return(MH(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",h,"DOWNLOAD_STATE_FAILED"));case 6:return g.b(a,qIH(X,d,c),8);case 8:return a.return(MH(c,!0,d.orchestrationActions));case 2:return A=g.k1(a),Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",H="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",A instanceof g.ri&&A.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
H="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V2("PDE handleAdd error"),a.return(MH(c,!1,void 0,Y,H,"DOWNLOAD_STATE_FAILED"))}})},GKt=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl;
return g.O(function(Xl){switch(Xl.J){case 1:return V=c.entityKey,G=g.jE(V).entityId,g.b(Xl,K6(X.J,{mode:"readonly",SS:!0},function(u){var q=NW(u,V,"playbackData"),Q=NW(u,g.Hc(G,"offlineVideoPolicy"),"offlineVideoPolicy");u=NW(u,g.Hc(G,"transfer"),"transfer");return g.eA.all([q,Q,u])}),2);
case 2:n=Xl.G;L=g.r(n);d=L.next().value;h=L.next().value;A=L.next().value;Y=d;H=h;a=A;if(!Y||!H)return Xl.return(MH(c,!0));W=[];Z=((F=Y)==null?0:F.playerResponseJson)?JSON.parse(Y.playerResponseJson):null;if(!(a&&Z&&X.qW.S("html5_refresh_deprecated_downloads"))){Xl.Wl(3);break}w=cBk(X,Z,a);return g.b(Xl,Vnk(X,a),4);case 4:W=Xl.G;case 3:v={lastPlayerResponseTimestampSeconds:Y.playerResponseTimestamp,offlineToken:H.offlineToken,formatIds:W};e={};if((m=a)==null?0:m.maximumDownloadQuality)e.maximumDownloadQuality=
a.maximumDownloadQuality;g.ZS(Xl,5);t=void 0;return g.b(Xl,ibV(X,c),7);case 7:return t=Xl.G,g.ZS(Xl,8),g.b(Xl,s5V(V,X.qW,{refreshData:v,qy:e,offlineSourceData:t,mediaCapabilities:w}),10);case 10:f=Xl.G;g.vw(Xl,9,5);break;case 8:return g.k1(Xl,5),U=hg(c)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",V2("PDE handleRefresh error"),Xl.return(MH(c,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",U,
"DOWNLOAD_STATE_FAILED"));case 9:return g.b(Xl,qIH(X,f,c),11);case 11:return Xl.return(MH(c,!0,f.orchestrationActions));case 5:return C=g.k1(Xl),K="PDE handleRefresh error",C instanceof Error&&(K="PDE handleRefresh error: "+C.message),nj="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",yl="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.ri&&C.type==="QUOTA_EXCEEDED"&&(nj="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",yl="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V2(K),Xl.return(MH(c,!1,void 0,nj,yl,"DOWNLOAD_STATE_FAILED"))}})},ibV=function(X,c){var V,G,n,L;
return g.O(function(d){if(d.J==1)return V=g.jE(c.entityKey).entityId,G=g.Hc(V,"videoDownloadContextEntity"),g.b(d,Do(X.J,G,"videoDownloadContextEntity"),2);n=d.G;return(L=n)!=null&&L.offlineModeType?d.return({offlineModeType:n.offlineModeType}):d.return(void 0)})},qIH=function(X,c,V){var G,n,L,d,h;
return g.O(function(A){if(A.J==1){if(!c.frameworkUpdates||!g.T(c.frameworkUpdates,xo))return A.return();if(!(g.T(c.frameworkUpdates,xo).mutations&&g.T(c.frameworkUpdates,xo).mutations.length>0&&g.T(c.frameworkUpdates,xo).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return A.Wl(2);G=g.jE(g.T(c.frameworkUpdates,xo).mutations[0].entityKey).entityId;return g.b(A,v$(X.J,G),3)}if(A.J!=2){n=A.G;L=g.T(V.actionMetadata,lD);if(h=(d=L)==null?void 0:d.playlistId)n.playlistId=h;n.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.Dv(X.qW)?g.b(A,Zj(G,X.J,V,X.U,n),2):g.Ty(X.qW)?g.b(A,ko(G,X.J,V,X.U),2):A.Wl(2)}return g.b(A,JSM(g.T(c.frameworkUpdates,xo)),0)})},MH=function(X,c,V,G,n,L){return new Oy(c?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",hg(X),V,G,n,L)},cBk=function(X,c,V){c=YIi(X.qW,V.cotn,c);
V=g.yu(c);return g.I8l(c,V,X.qW)},Vnk=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W;
return g.O(function(w){if(w.J==1)return V=[],g.b(w,K6(X.J,{mode:"readonly",SS:!0},function(F){var Z=[],v=c.offlineVideoStreams;if(v){v=g.r(v);for(var e=v.next();!e.done;e=v.next())Z.push(NW(F,e.value,"offlineVideoStreams"))}return g.eA.all(Z)}),2);
if(G=w.G)for(n=g.r(G),L=n.next();!L.done;L=n.next())if(d=L.value,h=void 0,(h=d)==null?0:h.streamsProgress)for(A=d.streamsProgress,Y=0;Y<A.length;Y++)H=A[Y],a=JSON.parse(H.formatStreamBytes),W={itag:a.itag,lmt:a.lastModified,xtags:a.xtags},V.push(W);return w.return(V)})},nGz=function(X,c){this.J=X;
this.qW=c},LlU=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w;
return g.O(function(F){switch(F.J){case 1:return V=hg(c),g.b(F,SJ(X.J,"videoPlaybackPositionEntity"),2);case 2:G=F.G;if(G.length===0)return F.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.ZS(F,3);return g.b(F,f6.getInstance(),5);case 5:n=F.G;if(!n)throw Error("prefStorage is undefined");return g.b(F,n.get("psi"),6);case 6:return L=F.G,A=(h=(d=L)==null?void 0:d.BI)!=null?h:"0",g.b(F,Bzp(G,A),7);case 7:return Y=F.G,H={isPaused:Y.watchHistoryPaused,BI:Y.syncTimestampUsec},g.b(F,n.set("psi",
H),8);case 8:if(H.isPaused){F.Wl(9);break}a=g.T(Y.frameworkUpdates,xo);if(!Y.frameworkUpdates||!a){F.Wl(9);break}return g.b(F,JSM(a),9);case 9:g.vw(F,4);break;case 3:return W=g.k1(F),w="PPE handleRefresh error: "+(W instanceof Error?W.message:"unknown error"),V2(w),F.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return F.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},yBA=function(X,c){var V,G,n,L,d,h,A,Y;
return g.O(function(H){switch(H.J){case 1:return V=hg(c),G=g.jE(c.entityKey).entityId,g.ZS(H,2),g.b(H,f6.getInstance(),4);case 4:n=H.G;if(!n)throw Error("prefStorage is undefined");return g.b(H,n.get("psi"),5);case 5:L=H.G;d=g.T(c.actionMetadata,dRA);if(((h=L)==null?void 0:h.isPaused)!==!1||(A=d)==null||!A.lastPlaybackPositionSeconds){H.Wl(6);break}Y={key:g.Hc(G,"videoPlaybackPositionEntity"),videoId:G,lastPlaybackPositionSeconds:d.lastPlaybackPositionSeconds};return g.b(H,C6(X.J,Y,"videoPlaybackPositionEntity"),
6);case 6:g.vw(H,3);break;case 2:return g.k1(H),H.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},hDi=function(X,c){var V,G,n;
return g.O(function(L){switch(L.J){case 1:V=hg(c);g.ZS(L,2);G=g.jE(c.entityKey).entityId;if(G==="!*$_ALL_ENTITIES_!*$")return g.b(L,xBr(X.J),5);n=g.Hc(G,"videoPlaybackPositionEntity");return g.b(L,ZeH(X.J,n),5);case 5:g.vw(L,3);break;case 2:return g.k1(L),L.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return L.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},ABG=function(X,c){this.api=X;
this.J=c;this.logger=new g.LD("woffle");this.G=!1;this.F8={Cs:this.Cs};this.logger.debug("Initialized OfflineMediaManager")},YVz=function(X){return g.O(function(c){return c.return(MFA(X))})},jIA=function(X){var c;
return g.O(function(V){if(V.J==1)return g.b(V,g.j2w(X),2);c=V.G;return V.return(c.filter(function(G){return!!G.url}).map(function(G){return G.url}))})},g5=function(X,c){var V=g.R6(c);
if(V===1||V===0)return Promise.resolve();(V=HOM(X,c))&&V.stopVideo();X.U=0;return YVz(c)},fV=function(X,c,V,G){V=V===void 0?!1:V;
G=G===void 0?!0:G;var n=typeof c==="string"?c:c.videoDetails.videoId;g.R6(n)===2&&((c=HOM(X,n))?c.stopVideo():X.logger.info(function(){return"Corresponding player for "+n+" not found. Pausing anyway"}),g.bj(n,2),X.U=2,V?amM(X.J):G&&$Rp(X.J))},HOM=function(X,c){var V;
return((V=X.player)==null?void 0:V.getVideoData().videoId)===c?X.player:null},Wlt=function(X,c,V){c.getPlayerResponse();
g.bj(c.videoId,2);X.U=2;X.G=!1;var G;(G=X.player)==null||G.dispose();X.player=X.api.vU(c);c={};X.player.F1((c.localmediachange=X.iC,c.signatureexpired=X.xL,c.statechange=X.E9_,c),X);var n=X.Cs(V);X.player.T$(g.L5(n,n,!0,"m"),!1);X.logger.debug(function(){return"Starting headless playback with quality: "+n});
X.player.mX(!1)},wLV=function(X,c){this.J=X;
this.qW=c},EGh=function(X,c){var V,G;
return g.O(function(n){switch(n.J){case 1:return V=hg(c),g.b(n,Do(X.J,c.entityKey,"transfer"),2);case 2:if(G=n.G)return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.ZS(n,3);return g.b(n,FlA(X,c),5);case 5:g.vw(n,4);break;case 3:return g.k1(n),n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},rBM=function(X,c){var V,G;
return g.O(function(n){switch(n.J){case 1:return V=hg(c),g.b(n,Do(X.J,c.entityKey,"transfer"),2);case 2:G=n.G;if(!G||G.transferState!=="TRANSFER_STATE_COMPLETE")return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.ZS(n,3);return g.b(n,FlA(X,c,!0),5);case 5:g.vw(n,4);break;case 3:return g.k1(n),n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},QIz=function(X,c){var V,G,n,L,d,h,A,Y,H,a;
return g.O(function(W){switch(W.J){case 1:return V=hg(c),G=g.jE(c.entityKey).entityId,g.b(W,K6(X.J,{mode:"readonly",SS:!0},function(w){var F=NW(w,c.entityKey,"transfer");w=NW(w,g.Hc(G,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eA.all([F,w])}),2);
case 2:n=W.G;L=g.r(n);d=L.next().value;h=L.next().value;A=d;Y=h;if(!A||A.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return W.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.ZS(W,3);A.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.b(W,C6(X.J,A,"transfer"),5);case 5:H=g.jE(A.key).entityId;y2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:H,U2:A,offlineModeType:(a=Y)==null?void 0:a.offlineModeType});g.vw(W,
4);break;case 3:return g.k1(W),W.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return W.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},FlA=function(X,c,V){V=V===void 0?!1:V;
var G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e;return g.O(function(m){switch(m.J){case 1:return G=g.T(c.actionMetadata,ZOi),n=g.jE(c.entityKey).entityId,L=g.Hc(n,"downloadStatusEntity"),g.b(m,K6(X.J,{mode:"readonly",SS:!0},function(t){var f=NW(t,L,"downloadStatusEntity");t=NW(t,g.Hc(n,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eA.all([f,t])}),2);
case 2:return d=m.G,h=g.r(d),A=h.next().value,Y=h.next().value,H=A,a=Y,W="TRANSFER_STATE_TRANSFER_IN_QUEUE",((w=H)==null?void 0:w.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(W="TRANSFER_STATE_PAUSED_BY_USER"),v={key:c.entityKey,transferState:W,cotn:g.JI(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(F=G)==null?void 0:F.maximumDownloadQuality,preferredAudioTrack:(Z=G)==null?void 0:Z.preferredAudioTrack,transferRetryCount:0,isRefresh:V,hasLoggedFirstStarted:!1},g.b(m,K6(X.J,
{mode:"readwrite",SS:!0},function(t){var f=[];V&&f.push(P_(t,g.Hc(n,"offlineVideoStreams")));f.push(u2(t,v,"transfer"));return g.eA.all(f)}),3);
case 3:if(!V){m.Wl(4);break}return g.b(m,YVz(n),4);case 4:y2({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:n,U2:v,offlineModeType:(e=a)==null?void 0:e.offlineModeType}),g.Ql(m)}})},vGV=function(X,c,V,G){if(!X.action.entityKey)throw Error("entityKey is missing.");
var n=g.jE(X.action.entityKey);n={entityType:n.XB,entityId:n.entityId,offlineOrchestrationActionType:X.action.actionType,orchestrationAction:{orchestrationActionId:X.actionId}};c&&(n.offlineOrchestrationActionResult=c.status,n.isRetryable=V?!1:c.J,c.U&&(n.offlineOrchestrationFailureReason=xRz(c.U,n.isRetryable)));var L,d;if((L=X.action.actionMetadata)==null?0:(d=L.offlineLoggingData)==null?0:d.offlineModeType)n.offlineModeType=X.action.actionMetadata.offlineLoggingData.offlineModeType;G&&(n.additionalOrchestrationActions=
G.map(function(h){return{orchestrationActionId:h.actionId}}));
return n},xRz=function(X,c){return X!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||c?X==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&c?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":X:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},kKA=function(X,c){var V={offlineOrchestrationContext:vGV(X)};
c=TSH(c,V);u5t(UBG(),c,X.rootActionId)},oGH=function(X,c,V,G){G=G===void 0?[]:G;
c={offlineOrchestrationContext:vGV(X,c,V,G)};c=TSH(3,c);u5t(UBG(),c,X.rootActionId)},eDG=function(){this.actions=[]},JBt=function(X,c){c=g.r(c);
for(var V=c.next();!V.done;V=c.next())V=V.value,kKA(V,1),X.actions.push(V);X.actions.sort(X.J)},mRM=function(X,c){if(c)for(var V=0;V<X.actions.length;V++)if(c==="!*$_ALL_ENTITIES_!*$"&&X.actions[V].actionId!==c||c!=="!*$_ALL_ENTITIES_!*$"&&X.actions[V].rootActionId===c&&X.actions[V].actionId!==c)X.actions.splice(V,1),V--},RDA=function(X,c){X=g.r(X.actions);
for(var V=X.next();!V.done;V=X.next())if(V.value.actionId===c)return!0;return!1},pV=function(X,c,V,G,n){g.I.call(this);
var L=this;this.G=X;this.kO=c;this.G_=V;this.D=G;this.qW=n;this.J=new eDG;this.B=new g.ii;this.U=new g.i_(function(){L.retry()});
this.T=NaN;this.Z=!1;this.F8={I2l:function(){return L.J},
u5:function(){return L.B},
uOO:function(){return L.U},
retry:function(){return L.retry()}};
g.N(this,this.U);this.C=this.G.observe(this.A7.bind(this))},OOt=function(X,c,V,G,n){var L;
return g.O(function(d){if(d.J==1)return L=new pV(X,c,V,G,n),g.b(d,bOh(L),2);tnM(L);return d.return(L)})},tnM=function(X){var c=X.J.actions[0];
return X.X?((c==null?void 0:c.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&X.X[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(X.Z=!0),Promise.resolve()):lmV(X)},lmV=function(X){var c,V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e;
return g.O(function(m){switch(m.J){case 1:if(X.X)throw Error("Already processing an action");if(X.vl())return m.return();c=X.J.actions.shift();V8z(X.G_,!c);if(c===void 0)return m.return();c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&c.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&mRM(X.J,c.actionId);V="";c.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&c.rootActionId===c.actionId&&(V=c.actionId);G=[c];X.X=G;if(n=X.kO[c.entityType]){m.Wl(2);break}X.X=
void 0;return g.b(m,lmV(X),3);case 3:return m.return();case 2:L=g.r(G);for(d=L.next();!d.done;d=L.next())h=d.value,kKA(h,2);g.ZS(m,4,5);return g.b(m,DPi(n,G.map(function(t){return t.action})),7);
case 7:A=m.G,Y=g.r(G),H=Y.next();case 8:if(H.done){m.Wl(10);break}a=H.value;W=A.get(a.action);return g.b(m,Mnr(X,a,W),9);case 9:H=Y.next();m.Wl(8);break;case 10:mRM(X.J,V);case 5:g.o8(m);X.X=void 0;g.eD(m,6);break;case 4:return w=g.k1(m),V2("Orchestration error",w),g.ZS(m,12),g.b(m,gGM(X,G),14);case 14:g.vw(m,5);break;case 12:F=g.k1(m);V2("Orchestration retry error",F);Z=g.r(G);for(v=Z.next();!v.done;v=Z.next())e=v.value,e.retryScheduleIndex<3&&JBt(X.J,[e]);m.Wl(5);break;case 6:return g.b(m,lmV(X),
0)}})},Mnr=function(X,c,V){var G,n,L,d,h,A,Y,H,a,W,w,F;
return g.O(function(Z){switch(Z.J){case 1:G=c.retryScheduleIndex+2===3;if(V.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Z.Wl(2);break}if(V.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Z.Wl(0);break}oGH(c,V,G);if(V.J&&c.retryScheduleIndex+1<3)return g.b(Z,gGM(X,[c]),0);L=((n=V)==null?0:n.G)?V.G:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";d={entityKey:c.action.entityKey,failureReason:L};h=void 0;g.Dv(X.qW)?h="mainVideoDownloadStateEntity":g.Ty(X.qW)&&(h="musicTrackDownloadMetadataEntity");
if(!h||!V.downloadState){Z.Wl(7);break}A=g.jE(c.action.entityKey).entityId;return g.b(Z,H$(A,h,X.G,V.downloadState),7);case 7:nV(X.D,d);if(V.downloadState==="DOWNLOAD_STATE_FAILED"&&X.qW.S("html5_auto_retry_failed_pde_actions")){Z.Wl(0);break}V2("Orchestration result is not retryable, deleting action");return g.b(Z,ZeH(X.G,Ey(c).key),0);case 2:Y=void 0;try{Y=(H=V.X)==null?void 0:H.map(function(v){return X.createAction(v,c)})}catch(v){return oGH(c,V,G),a={entityKey:c.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},nV(X.D,a),V2("Orchestration subactions creation error",v),Z.return()}oGH(c,V,G,Y);if(!Y){Z.Wl(12);break}W=Y.map(function(v){return Ey(v)});
w=0;case 13:if(!(w<Y.length)||X.Z){Z.Wl(15);break}return g.b(Z,K6(X.G,{mode:"readwrite",SS:!0},function(v){var e=[];e.push(jop(v,W.slice(w,w+10),"offlineOrchestrationActionWrapperEntity"));return g.eA.all(e)}),16);
case 16:w+=10;Z.Wl(13);break;case 15:if(X.Z)return X.Z=!1,Z.return();case 12:return F=Ey(c),g.b(Z,ZeH(X.G,F.key),17);case 17:kKA(c,4),g.Ql(Z)}})},NbG=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w;
return g.O(function(F){V=[];G=Infinity;n=4E3;L=g.r(c);for(d=L.next();!d.done;d=L.next())h=d.value,A=Number(h.enqueueTimeSec),Y=fmA(A),H=h.retryScheduleIndex,a=H!=null&&H>0,Y>0&&a?(G=Math.min(G,A),n=Math.min(Y,n)):V.push(h);isFinite(G)&&(!X.U.isActive()||G<X.T)&&(X.T=G,X.U.start(n));X.B.wJ()||(W=V.length,V=V.filter(function(Z){var v;Z=((v=Z.actionProto)==null?void 0:v.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!pLA.includes(Z)}),w=V.length<W,!X.U.isActive()&&w&&X.U.start(1));
V.length>0&&Imk(X,V);return g.b(F,tnM(X),0)})},Tbk=function(X){var c,V,G,n,L,d,h;
return g.O(function(A){if(A.J==1)return g.b(A,UR7(X),2);c=A.G;V=[];G=g.r(c);for(n=G.next();!n.done;n=G.next())L=n.value,d=g.jE(L.key),h=d.entityId,RDA(X.J,h)||V.push(L);return g.b(A,NbG(X,V),0)})},fmA=function(X){X=X*1E3-Date.now();
return X>4E3?4E3:X},gGM=function(X,c){var V,G,n;
return g.O(function(L){V=g.r(c);for(G=V.next();!G.done;G=V.next()){n=G.value;var d=void 0,h=void 0,A=((h=n.action)==null?void 0:(d=h.actionMetadata)==null?void 0:d.retryScheduleIntervalsInSeconds)||[1,2,4];d=1;n.retryScheduleIndex<A.length&&(d=A[n.retryScheduleIndex]);n.J=d*1E3+Date.now();n.retryScheduleIndex++}return g.b(L,uKp(X,c),0)})},bOh=function(X){var c;
return g.O(function(V){if(V.J==1)return g.b(V,SJ(X.G,"offlineOrchestrationActionWrapperEntity"),2);c=V.G;return g.b(V,NbG(X,c),0)})},Imk=function(X,c){c.length!==0&&c.forEach(function(V){V=FL(V);
V.retryScheduleIndex<3&&JBt(X.J,[V])})},UR7=function(X,c){var V;
return g.O(function(G){if(G.J==1)return g.b(G,SJ(X.G,"offlineOrchestrationActionWrapperEntity",c),2);V=G.G;return G.return(V.filter(mBG))})},uKp=function(X,c){if(c.length===0)return Promise.resolve([]);
c=c.map(function(V){return Ey(V)});
return Qo_(X.G,c)},P_p=function(X){this.DR=X;
this.J=void 0},zD7=function(X,c){var V,G,n,L;
return g.O(function(d){V=c.videoId;G=!0;if(c.captionTracks.length)n=hCA(c),X.J=new g.rh(X.DR,c,n);else if(c.YM)L=g.QCL(c),X.J=new g.ZL(X.DR,c.YM,V,L,c.H5,c.eventId),G=c.H5;else return d.return();return d.return(new Promise(function(h){var A;(A=X.J)==null||A.kD({s_:function(){return g.O(function(Y){if(Y.J==1)return g.b(Y,X.s_(V,G),2);h();g.Ql(Y)})},
Iu:function(){}})}))})},Bbr=function(X){var c;
return g.O(function(V){if(V.J==1)return g.b(V,lXM(X),2);c=V.G;return V.return(!!c&&c.length>0)})},I1=function(X){g.I.call(this);
this.J=X;this.G=this.J.observe(this.U.bind(this))},Klp=function(X,c){var V,G,n,L,d,h,A;
return g.O(function(Y){switch(Y.J){case 1:if(c.length===0)return Y.return([]);V=c.map(function(H){return g.Hc(H,"transfer")});
return g.b(Y,SJ(X.J,"transfer",V),2);case 2:G=Y.G;n=G.filter(mBG).map(function(H){return g.jE(H.key).entityId});
L=c.filter(function(H){return n.indexOf(H)===-1});
if(L.length===0)return Y.return([]);d=g.r(L);h=d.next();case 3:if(h.done){Y.Wl(5);break}A=h.value;return g.b(Y,YVz(A),4);case 4:h=d.next();Y.Wl(3);break;case 5:return Y.return(L)}})},DR7=function(X,c,V,G,n,L){var d,h,A;
return g.O(function(Y){d="STREAM_TYPE_UNKNOWN";V.video&&V.audio?(d="STREAM_TYPE_AUDIO_AND_VIDEO",V2("unexpected stream type")):V.video&&!V.audio?d="STREAM_TYPE_VIDEO":!V.video&&V.audio&&(d="STREAM_TYPE_AUDIO");h=g.Hc(c,"offlineVideoStreams");A={numBytesDownloaded:n.toFixed(),numTotalBytes:L.toFixed(),streamType:d,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(G),itag:d==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(V.itag):void 0};return g.b(Y,K6(X,{mode:"readwrite",SS:!0},
function(H){var a=NW(H,h,"offlineVideoStreams"),W=NW(H,g.Hc(c,"transfer"),"transfer");return g.eA.all([a,W]).then(function(w){w=g.r(w);var F=w.next().value;w=w.next().value;if(!w)return P_(H,h).then(function(){});
var Z=sI_(F);F=C_i(F,G,A,h);var v=u2(H,F,"offlineVideoStreams");sI_(F)>Z&&(w.lastProgressTimeMs=Date.now().toString());Z=[v];w.offlineVideoStreams||(w.offlineVideoStreams=[]);w.offlineVideoStreams.indexOf(h)===-1&&(w.offlineVideoStreams.push(h),Z.push(u2(H,w,"transfer")));return g.eA.all(Z)})}),0)})},SVi=function(X,c){var V,G,n,L,d;
return g.O(function(h){if(h.J==1)return V=g.Hc(c,"offlineVideoStreams"),g.b(h,Do(X,V,"offlineVideoStreams"),2);G=h.G;if(!G||!G.streamsProgress)return h.return();n=g.r(G.streamsProgress);for(L=n.next();!L.done;L=n.next())d=L.value,d.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",d.numTotalBytes!==d.numBytesDownloaded&&(d.numBytesDownloaded=d.numTotalBytes);return g.b(h,C6(X,G,"offlineVideoStreams"),0)})},C_i=function(X,c,V,G){if(X&&X.streamsProgress){G=X;
a:{c=c.itag+";"+c.xtags;for(var n=X.streamsProgress,L=0;L<n.length;L++){var d=JSON.parse(n[L].formatStreamBytes);if(d.itag+";"+d.xtags===c){n[L]=V;V=n;break a}}n.push(V);V=n}G.streamsProgress=V}else X={key:G,streamsProgress:[V]};return X},sI_=function(X){if(X==null?0:X.streamsProgress){var c=0;
X=X.streamsProgress;for(var V=0;V<X.length;V++){var G=X[V];isNaN(Number(G.numBytesDownloaded))?V2("stream progress bytes number invalid"):c+=Number(G.numBytesDownloaded)}return c}return 0},iOi=function(X,c,V,G){g.I.call(this);
var n=this;this.G=X;this.api=c;this.YO=V;this.A7=G;this.B=new g.ii;this.X=new g.i_(function(){n.J&&n.J.transferState==="TRANSFER_STATE_TRANSFERRING"&&n.B.wJ()&&((n.J.transferRetryCount||0)<3?fV(n.D,n.Z,!1,!1):g5(n.D,n.Z.videoDetails.videoId),n.YD("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.G_=this.Pl=0;this.C=this.T=!1;this.LS=g.F1(this.api.j().experiments,"html5_transfer_processing_logs_interval");this.QK=new g.N_(this);this.F8={cQh:function(){return n.X},
OOS:function(){return n.A7},
u5:function(){return n.B}};
this.kO=this.G.observe(this.Qn.bind(this));this.D=new ABG(c,this);this.fS=new P_p(c);this.NW=new I1(this.G);this.Hl=this.B.listen("publicytnetworkstatus-online",this.Q4.bind(this));this.wy=this.B.listen("publicytnetworkstatus-offline",this.MXS.bind(this));this.C=this.api.j().S("html5_less_transfer_processing_logs");g.N(this,this.QK);this.QK.L(c,"offlinetransferpause",this.lLh);g.Dv(this.api.j())?this.U="mainVideoDownloadStateEntity":g.Ty(this.api.j())&&(this.U="musicTrackDownloadMetadataEntity")},
qV7=function(X){return g.O(function(c){if(c.J==1)c=g.b(c,tFA(),2);
else{var V=X.NW;var G=g.mf();G=Object.keys(G);V=Klp(V,G);c=g.b(c,V,0)}return c})},Uy=function(X,c){c=c===void 0?!1:c;
var V;return g.O(function(G){if(G.J==1){if(X.J)throw Error("Already downloading a video");X.G_=0;X.T=!1;return g.b(G,X6_(X),2)}return G.J!=4?(V=G.G,GSH(X.YO,!V),V&&X.B.wJ()?c?g.b(G,new Promise(function(n){g.rd(n,1E3)}),4):G.Wl(4):(!V&&X.J&&NH(X),G.Wl(0))):g.b(G,cx_(X,V),0)})},VkH=function(X){return g.O(function(c){if(c.J==1)return X.Z?g.b(c,g5(X.D,X.Z.videoDetails.videoId),3):c.Wl(0);
NH(X);g.Ql(c)})},GwV=function(X,c){var V,G,n;
return g.O(function(L){switch(L.J){case 1:return g.ZS(L,2),(V=!!c.captionTracks.length||!!c.YM)?g.b(L,Bbr(c.videoId),4):L.return();case 4:return(G=L.G)?L.return():g.b(L,zD7(X.fS,c),5);case 5:g.vw(L,0);break;case 2:n=g.k1(L),V2("Caption downloading error",n,c.cotn),g.Ql(L)}})},cx_=function(X,c){var V,G,n,L,d,h;
return g.O(function(A){switch(A.J){case 1:if(X.T)return A.return();X.T=!0;X.J=c;V=g.jE(X.J.key);G=V.entityId;n=void 0;if(X.J.transferState==="TRANSFER_STATE_TRANSFERRING")return g.b(A,T6(X,G),7);if(X.J.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||X.J.transferRetryCount||X.J.hasLoggedFirstStarted){A.Wl(3);break}return g.b(A,T6(X,G),5);case 5:return n=A.G,X.J.hasLoggedFirstStarted=!0,g.b(A,nDA(X),6);case 6:nQH({videoId:G,U2:X.J,offlineModeType:n},void 0,void 0,!0);A.Wl(3);break;case 7:n=A.G,
y2({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:G,U2:X.J,offlineModeType:n});case 3:return g.b(A,Loz(X),8);case 8:return L=null,g.ZS(A,9),g.b(A,dwt(X,c),11);case 11:L=A.G;X.Z=L;g.vw(A,10);break;case 9:return d=g.k1(A),V2("error getting player response",d,c.cotn),g.b(A,X.YD("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return A.return();case 10:return h=YIi(X.api.j(),c.cotn,L),g.b(A,GwV(X,h),13);case 13:return g.b(A,jIA(h.videoId),
14);case 14:h.Rm=A.G,Wlt(X.D,h,c.maximumDownloadQuality),X.X.start(108E5),g.Ql(A)}})},X6_=function(X){var c,V;
return g.O(function(G){if(G.J==1)return g.b(G,SJ(X.G,"transfer"),2);c=G.G;V=c.filter(yxr).sort(hFA);return V.length===0?G.return():G.return(V[0])})},Loz=function(X){var c,V,G;
return g.O(function(n){if(n.J==1){if(!X.J)return uD(X,"onTransferStart"),n.return();X.X.start(108E5);return g.b(n,P$(X,"TRANSFER_STATE_TRANSFERRING"),2)}c=X.J;return(G=((V=c)==null?0:V.key)?g.jE(c.key).entityId:"")&&X.U?g.b(n,H$(G,X.U,X.G,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):n.Wl(0)})},amM=function(X){var c,V,G,n;
g.O(function(L){switch(L.J){case 1:if(!X.J){uD(X,"onTransferPausedByUser");L.Wl(2);break}c=X.J;X.X.stop();return g.b(L,P$(X,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:G=((V=c)==null?0:V.key)?g.jE(c.key).entityId:"";if(!G||!X.U){L.Wl(4);break}return g.b(L,H$(G,X.U,X.G,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.b(L,T6(X,G),6);case 6:n=L.G,Lht({videoId:G,U2:c,offlineModeType:n});case 2:NH(X),Uy(X),g.Ql(L)}})},$Rp=function(X){var c,V,G;
g.O(function(n){if(n.J==1){if(!X.J)return uD(X,"onTransferPausedByNetwork"),n.return();X.X.stop();return g.b(n,P$(X,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(n.J!=3)return c=X.J,(G=((V=c)==null?0:V.key)?g.jE(c.key).entityId:"")&&X.U?g.b(n,H$(G,X.U,X.G,"DOWNLOAD_STATE_PAUSED"),3):n.Wl(3);NH(X);g.Ql(n)})},AxV=function(X){var c,V,G,n,L;
g.O(function(d){switch(d.J){case 1:if(!X.J)return uD(X,"onTransferComplete"),d.return();c=X.J;X.X.stop();if(!c||!X.Z){d.Wl(2);break}V=YIi(X.api.j(),c.cotn,X.Z);return g.b(d,GwV(X,V),2);case 2:return g.b(d,P$(X,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:n=((G=c)==null?0:G.key)?g.jE(c.key).entityId:"";if(!n||!X.U){d.Wl(5);break}return g.b(d,H$(n,X.U,X.G,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.b(d,SVi(X.G,n),7);case 7:return g.b(d,T6(X,n),8);case 8:L=d.G,y2({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:n,U2:c,offlineModeType:L}),NH(X),Uy(X),g.Ql(d)}})},Yvt=function(X,c,V){var G,n;
g.O(function(L){switch(L.J){case 1:if(!X.J)return uD(X,"onTransferProgress: "+c),L.return();if(X.J.transferState==="TRANSFER_STATE_TRANSFERRING"){L.Wl(2);break}return g.b(L,Loz(X),2);case 2:G=Date.now();if(!(G-X.Pl>1E3)){L.Wl(4);break}X.Pl=G;return g.b(L,DR7(X.G,V.videoId,V.G,V.Yh,V.bytesDownloaded,V.J),5);case 5:if(X.C&&!(X.C&&G-X.G_>X.LS)){L.Wl(4);break}X.G_=G;return g.b(L,T6(X,c),7);case 7:n=L.G,nQH({videoId:c,U2:X.J,offlineModeType:n},V.bytesDownloaded,V.J);case 4:X.X.start(108E5),g.Ql(L)}})},
jbU=function(X){var c=(X.J.transferRetryCount||0)<3;
c&&(X=X.J,X.transferRetryCount=(X.transferRetryCount||0)+1);return c},HT7=function(X,c){c=c===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":c;
var V,G,n,L;return g.O(function(d){if(d.J==1)return X.J||uD(X,"setTransferToFailed: "+c),V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c==="TRANSFER_FAILURE_REASON_NETWORK"?V="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":c==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.b(d,P$(X,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",c),2);if(d.J!=3)return nV(X.A7,{entityKey:(G=X.J)==null?void 0:G.key,failureReason:V}),
n=X.J?g.jE(X.J.key).entityId:"",g.b(d,T6(X,n),3);L=d.G;var h={videoId:n,U2:X.J,offlineModeType:L},A=c,Y={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};A&&(Y.transferFailureReason=A,Y.failureReason=dPA(A));y2(Y,h);g.Ql(d)})},P$=function(X,c,V,G){var n;
return g.O(function(L){if(L.J==1){if(!X.J)return uD(X,"saveTransferState: "+c),L.return();X.J.transferState=c;X.J.failureReason=G;g.ZS(L,2);return g.b(L,nDA(X,function(d){return V?Us(d,"offlineVideoStreams",X.J.offlineVideoStreams).then(function(h){for(var A=g.r(h),Y=A.next();!Y.done;Y=A.next())if((Y=Y.value)&&Y.streamsProgress){Y=g.r(Y.streamsProgress);for(var H=Y.next();!H.done;H=Y.next())H.value.streamState=V}return jop(d,h.filter(function(a){return!!a}),"offlineVideoStreams")}):g.eA.resolve(void 0)}),
4)}if(L.J!=2)return g.vw(L,0);
n=g.k1(L);return n instanceof g.ri&&n.type==="QUOTA_EXCEEDED"?g.b(L,X.YD("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):L.Wl(0)})},nDA=function(X,c){var V;
return g.O(function(G){if(!X.J)return G.return();V=X.J;return g.b(G,K6(X.G,{mode:"readwrite",SS:!0},function(n){var L=[u2(n,V,"transfer")];c&&L.push(c(n));return g.eA.all(L)}),0)})},NH=function(X){X.J=void 0;
X.Z=void 0;X.X.stop()},dwt=function(X,c){var V,G,n,L,d;
return g.O(function(h){if(h.J==1)return V=g.jE(c.key),G=V.entityId,n=g.Hc(G,"playbackData"),g.b(h,Do(X.G,n,"playbackData"),2);L=h.G;if((d=L)==null?0:d.playerResponseJson)return h.return(JSON.parse(L.playerResponseJson));throw Error("No PlayerResponse found");})},uD=function(X,c){X.api.Oy("woffle",{mcte:c});
V2("missing current transfer entity.")},T6=function(X,c){var V,G,n;
return g.O(function(L){if(L.J==1)return g.b(L,Do(X.G,g.Hc(c,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);V=L.G;return L.return((n=(G=V)==null?void 0:G.offlineModeType)!=null?n:void 0)})},yxr=function(X){return aFG[X.transferState]!==void 0},hFA=function(X,c){var V=aFG[X.transferState],G=aFG[c.transferState];
return V!==G?V-G:Number(X.enqueuedTimestampMs)-Number(c.enqueuedTimestampMs)},z6=function(X,c){var V=this;
this.qW=X;this.api=c;this.B=new g.ii;this.Z=new g.Ei;this.F8={NK:function(){return V.U.F8.NK()},
u5:function(){return V.B},
GPR:function(){return V.U},
O9:function(){return V.O9()},
cR:function(){return V.cR()},
SJ:function(){return V.SJ()},
d2:function(){return V.d2()},
Ei:function(){return V.Ei()},
WH:function(G){return V.WH(G)}};
this.U=new qhz(function(){return $wA(V)},function(){V.SJ()},this.api.Zm(),this.api.S.bind(this.api));
this.J=new G6(this.api);XI7(this.U)},$wA=function(X){return g.O(function(c){X.api.z_("onOrchestrationBecameLeader");
return g.b(c,X.cR(),0)})},w6t=function(X){var c,V;
return g.O(function(G){if(G.J==1)return g.b(G,i2(),2);if(G.J!=3){c=G.G;if(!c)return V2("PES is undefined"),G.return();X.G=new iOi(c,X.api,X.U,X.J);V=X.h6(c);return g.b(G,OOt(c,V,X.U,X.J,X.qW),3)}X.D=G.G;return g.b(G,Wor(X),0)})},Wor=function(X){var c;
return g.O(function(V){switch(V.J){case 1:if(!X.G)return V2("transferManager is undefined"),V.return();if(X.G.J){V.Wl(2);break}return g.b(V,Uy(X.G),2);case 2:if(!X.qW.S("woffle_enable_main_downloads_library")){V.Wl(4);break}return g.b(V,X.Qw(),4);case 4:if(!X.qW.S("html5_offline_playback_position_sync")){V.Wl(6);break}return g.b(V,X.nR(),7);case 7:return g.b(V,X.WH(864E5),6);case 6:return g.b(V,X.refreshAllStaleEntities(43200,!0),9);case 9:return g.b(V,X.Eu(),10);case 10:if(!X.qW.S("html5_retry_downloads_for_expiration")){V.Wl(11);
break}return g.b(V,X.Ei(),11);case 11:return X.T=g.Q8(function(){X.refreshAllStaleEntities(43200,!0);X.Eu()},9E5),g.c8(g.GJ(),function(){return X.d2()}),g.b(V,i2(),13);
case 13:return c=V.G,g.b(V,iek(c),14);case 14:ceG(X.U),g.Ql(V)}})},FoA=function(){var X,c,V,G,n,L;
return g.O(function(d){switch(d.J){case 1:return g.b(d,i2(),2);case 2:X=d.G;if(!X)return d.return([]);c=Date.now()/1E3;return g.b(d,SJ(X,"offlineVideoPolicy"),3);case 3:V=d.G,G=g.r(V),n=G.next();case 4:if(n.done){d.Wl(6);break}L=n.value;if(!(L.expirationTimestamp&&Number(L.expirationTimestamp)<c)){d.Wl(5);break}L.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";L.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.b(d,C6(X,L,"offlineVideoPolicy"),5);
case 5:n=G.next();d.Wl(4);break;case 6:return d.return(V.map(function(h){return h.key}))}})},B$=function(X,c,V,G,n){var L,d,h;
return g.O(function(A){if(A.J==1)return g.b(A,i2(),2);L=A.G;if(!L)return A.return([]);d=c.map(function(Y){var H=g.Hc(Y,V);H={actionType:G,entityKey:H,actionMetadata:Object.assign({},j5k(),n)};G!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(H.actionMetadata.priority=0);Y=new w5(V,Y,H);return Ey(Y)});
h=Qo_(L,d);XI7(X.U);return A.return(h)})},EDA=function(X,c,V,G){var n,L,d,h,A,Y,H,a;
return g.O(function(W){switch(W.J){case 1:n=[],L=g.r(c),d=L.next();case 2:if(d.done){W.Wl(4);break}h=d.value;if(h.upToDate||V&&!h.shouldAutoSyncMetadata||!h.playlistId){W.Wl(3);break}A={};switch(G){case "mainPlaylistEntity":Y={nextAutoRefreshIntervalSeconds:h.checkInSeconds,autoSync:V};A={mainPlaylistEntityActionMetadata:Y};break;case "musicPlaylist":H={autoSync:V},A={musicPlaylistEntityActionMetadata:H}}return g.b(W,B$(X,[h.playlistId],G,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",A),6);case 6:(a=
W.G)&&n.push.apply(n,g.x(a));case 3:d=L.next();W.Wl(2);break;case 4:return W.return(n)}})},rxU=function(X,c){var V;
return g.O(function(G){return c.length?(V=j5k(),g.z8(V,lD,{isEnqueuedForExpiredStreamUrlRefetch:!0}),X.api.Oy("qrd",{v:c.length}),G.return(B$(X,c,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V))):G.return([])})},QbH=function(X,c,V){this.J=X;
this.qW=c;this.U=V},vDi=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m;
return g.O(function(t){switch(t.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,L=[],g.ZS(t,2),g.b(t,ZTV(X,n),4);case 4:L=t.G;if(!(X.qW.S("woffle_enable_main_downloads_library")&&((d=L)==null?0:d.length))){t.Wl(5);break}return g.b(t,kSA(X.J,[c.entityKey]),5);case 5:g.vw(t,3);break;case 2:return h=g.k1(t),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.ri&&h.type==="QUOTA_EXCEEDED"?(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):V2("Playlist add error"),t.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,A,Y));case 3:H=[];if(!X.qW.S("html5_offline_prevent_redownload_downloaded_video")){t.Wl(7);break}return g.b(t,Aet(X.J,"mainVideoEntity",L),8);case 8:L=t.G;case 7:if((a=L)==null?0:a.length)for(W=g.r(L),w=W.next();!w.done;w=W.next())if(F=w.value,Z=F.offlineVideoData,v=void 0,(v=Z)==null?0:v.videoId)e=void 0,m=Number(((e=c.actionMetadata)==null?void 0:e.priority)||
0)+1,H.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Z.videoId,"mainVideoEntity",m,KV,xwU(c,Z,n)));return t.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,H))}})},oDG=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R,l,p,cw,Lj,ds,M,jD,Fl,As,ts,$U,Ih,aR,zt,Nx,hi,O5,P1,Yb,up,UL,PW,rW,j9,R3,aA,bP,lm,MX,oj,iu,zv,Go,Zm,IL;
return g.O(function($5){switch($5.J){case 1:return V=hg(c),G=c.entityKey,n=g.jE(G).entityId,L=[],d=!1,n==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.b($5,SJ(X.J,"mainPlaylistEntity"),5)):g.b($5,Do(X.J,G,"mainPlaylistEntity"),4);case 4:(h=$5.G)&&L.push(h);$5.Wl(3);break;case 5:L=$5.G;case 3:if((A=L)==null||!A.length)return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Y=g.T(c.actionMetadata,kwH);a=(H=Y)==null?void 0:H.nextAutoRefreshIntervalSeconds;w=(W=Y)==null?void 0:W.autoSync;F=[];v=Z=
!0;e=!1;if(!d&&w===!1){$5.Wl(6);break}g.ZS($5,7);return g.b($5,I0V(0,!!w,!0,L),9);case 9:F=$5.G;g.vw($5,8);break;case 7:m=g.k1($5);if(!(m instanceof Error&&m.message==="No data")){m instanceof Error&&m.message==="Empty response body"&&V2(m.message);$5.Wl(8);break}return n==="!*$_ALL_ENTITIES_!*$"?g.b($5,EQ_(X.J,c,X.U,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.b($5,wIi(n,X.J,c,X.U),8);case 8:if(!F.length||!d&&F[0].playlistId!==n)return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));case 6:if(d){t=[];f=g.r(F);for(U=f.next();!U.done;U=f.next())C=U.value,C.upToDate||w&&!C.shouldAutoSyncMetadata||!C.playlistId||(K={nextAutoRefreshIntervalSeconds:C.checkInSeconds,autoSync:w},t.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C.playlistId,"mainPlaylistEntity",0,KV,{mainPlaylistEntityActionMetadata:K})));return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,t))}F.length&&(nj=F[0],e=!!nj.upToDate,w&&(Z=(yl=nj.shouldAutoSyncMetadata)!=null?yl:!0,v=(Xl=nj.shouldAutoSyncVideos)!=
null?Xl:!0,nj.checkInSeconds&&(a=nj.checkInSeconds)));if(e||!Z)return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));u=[];q=L[0];if(!q.downloadState){Q=void 0;$5.Wl(15);break}return g.b($5,Do(X.J,q.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Q=$5.G;case 15:return P=Q,Zi=((UD=P)==null?0:UD.addedTimestampMillis)?String(P.addedTimestampMillis):void 0,g.ZS($5,17),g.b($5,ZTV(X,n,Zi,a),19);case 19:u=$5.G;g.vw($5,18);break;case 17:ah=g.k1($5);if(!(ah instanceof Error&&
ah.message==="No data for playlist")){if(ah instanceof Error&&ah.message==="Empty response body for playlist")V2(ah.message);else return Js="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SD="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ah instanceof g.ri&&ah.type==="QUOTA_EXCEEDED"&&(Js="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SD="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),$5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,Js,SD));$5.Wl(18);
break}return g.b($5,wIi(n,X.J,c,X.U),18);case 18:if(!v)return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Lt=[];wM=new Map;if((k=u)==null?0:k.length)for(J=g.r(u),R=J.next();!R.done;R=J.next())l=R.value,p=l.offlineVideoData,cw=void 0,((cw=p)==null?0:cw.videoId)&&wM.set(p.videoId,p);Lj=new Map;ds=[];if((M=q)==null?0:(jD=M.videos)==null?0:jD.length)for(Fl=g.r(q.videos),As=Fl.next();!As.done;As=Fl.next())if(ts=As.value,$U=JSON.parse(g.jE(ts).entityId),Ih=$U.videoId)wM.has(Ih)?(Lj.set(Ih,
wM.get(Ih)),wM.delete(Ih)):ds.push(Ih);zt=Number(((aR=c.actionMetadata)==null?void 0:aR.priority)||0)+1;Nx=g.r(wM.entries());for(hi=Nx.next();!hi.done;hi=Nx.next())O5=hi.value,P1=g.r(O5),Yb=P1.next().value,up=P1.next().value,UL=Yb,PW=up,Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",UL,"mainVideoEntity",zt,KV,xwU(c,PW,n)));rW=g.r(Lj.entries());for(j9=rW.next();!j9.done;j9=rW.next())R3=j9.value,aA=g.r(R3),bP=aA.next().value,lm=aA.next().value,MX=bP,oj=lm,Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
MX,"mainVideoEntity",zt,KV,xwU(c,oj,n)));iu=g.r(ds);for(zv=iu.next();!zv.done;zv=iu.next())Go=zv.value,Zm={playlistId:n},IL={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Zm},Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Go,"mainVideoEntity",0,KV,IL));return $5.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Lt))}})},eFV=function(X,c){var V,G,n,L;
return g.O(function(d){switch(d.J){case 1:return V=hg(c),g.ZS(d,2),G=g.jE(c.entityKey).entityId,G==="!*$_ALL_ENTITIES_!*$"?g.b(d,EQ_(X.J,c,X.U,(n=c.actionMetadata)==null?void 0:(L=n.offlineLoggingData)==null?void 0:L.offlineDeleteReason),5):g.b(d,wIi(G,X.J,c,X.U),6);case 6:if(!X.qW.S("woffle_enable_main_downloads_library")){d.Wl(5);break}return g.b(d,oQU(X.J,c.entityKey),5);case 5:g.vw(d,3);break;case 2:return g.k1(d),d.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return d.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},ZTV=function(X,c,V,G){var n,L,d,h,A,Y,H;
return g.O(function(a){switch(a.J){case 1:return g.b(a,f0_([c]),2);case 2:return n=a.G,g.b(a,JxG(X,n[0],V,G),3);case 3:return L=a.G,d=L.mainPlaylistEntity,h=L.q5R,Y=$PM(d,(A=h)==null?void 0:A.avatar),g.ZS(a,4),g.b(a,Q2(Y),6);case 6:g.vw(a,5);break;case 4:H=g.k1(a),H instanceof Error&&H.message==="Failed to fetch"&&V2(H.message);case 5:return a.return(n[0].videos)}})},JxG=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f;
return g.O(function(U){switch(U.J){case 1:n=Date.now().toString();V||(V=n);L=c.videos;d=c.playlistId;h=[];A=[];if(L)for(Y=g.r(L),H=Y.next();!H.done;H=Y.next()){a=H.value;W=a.offlineVideoData;if(!W||!W.videoId)throw V2("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");w=W.videoId;F={videoId:w,playlistId:d};Z={id:g.Hc(JSON.stringify(F),"mainPlaylistVideoEntity"),video:g.Hc(w,"mainVideoEntity")};h.push(Z);A.push(Z.id)}e={key:g.Hc(d,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:V,lastSyncedTimestampMillis:n};m={key:g.Hc(d,"mainPlaylistEntity"),playlistId:d,videos:A,title:c.title,thumbnailStyleData:mwM(c),visibility:RF_(c),downloadState:e.key};c.channel&&(t=c.channel.offlineChannelData,v=bTH(g.Hc(d,"ytMainChannelEntity"),t),m.channelOwner=v.id);((f=m)==null?0:f.entityMetadata)?(m.entityMetadata.offlineLastModifiedTimestampSeconds=c.lastModifiedTimestamp,G&&(m.entityMetadata.nextAutoRefreshIntervalSeconds=String(G))):m&&(m.entityMetadata={nextAutoRefreshIntervalSeconds:G?
String(G):void 0,offlineLastModifiedTimestampSeconds:c.lastModifiedTimestamp});g.ZS(U,2);return g.b(U,K6(X.J,{mode:"readwrite",SS:!0},function(C){var K=u2(C,m,"mainPlaylistEntity"),nj=u2(C,e,"mainPlaylistDownloadStateEntity");K=[K,nj];nj=g.r(h);for(var yl=nj.next();!yl.done;yl=nj.next())K.push(u2(C,yl.value,"mainPlaylistVideoEntity"));v&&K.push(u2(C,v,"ytMainChannelEntity"));return g.eA.all(K)}),4);
case 4:g.vw(U,3);break;case 2:throw g.k1(U),V2("PES failure for playlist"),Error("PES failure for playlist");case 3:return U.return({mainPlaylistEntity:m,q5R:v,mM7:h})}})},bTH=function(X,c){return{id:X,
channelId:c.channelId,title:c.title,avatar:c.thumbnail}},mwM=function(X){var c=[],V=X.videos;
V&&V.length>0&&c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:V[0].offlineVideoData.thumbnail}}});if((X=X.additionalMetadadatas)&&X.length>0)for(X=g.r(X),V=X.next();!V.done;V=X.next()){var G=V.value.offlineBundleItemPlaylistData,n=void 0;V=(n=G)==null?void 0:n.style;n=void 0;G={collageThumbnail:{coverThumbnail:(n=G)==null?void 0:n.coverThumbnail}};switch(V){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:G});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:G});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:G});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":c.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:G})}}return c},RF_=function(X){switch(X.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},xwU=function(X,c,V){c={offlineVideoData:c,
playlistId:V};if(X=g.T(X.actionMetadata,kwH))c.maximumDownloadQuality=X.maximumDownloadQuality;return{mainVideoEntityActionMetadata:c}},tki=function(X,c,V){this.J=X;
this.qW=c;this.U=V},Mk_=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F;
return g.O(function(Z){switch(Z.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,L=g.T(c.actionMetadata,sy),h=!((d=L)==null?0:d.playlistId),g.ZS(Z,2),g.b(Z,OTG(X,n,void 0,(A=L)==null?void 0:A.offlineVideoData,h),4);case 4:g.vw(Z,3);break;case 2:return Y=g.k1(Z),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.ri&&Y.type==="QUOTA_EXCEEDED"&&(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Z.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,H,a));case 3:W=1;W=Number(((w=c.actionMetadata)==null?void 0:w.priority)||0)+1;var v=(v=g.T(c.actionMetadata,sy))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;F=tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n,"playbackData",W,lFA,v);return Z.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,[F]))}})},gDA=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m;
return g.O(function(t){switch(t.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,g.b(t,Do(X.J,c.entityKey,"mainVideoEntity"),2);case 2:L=t.G;if(!L){d=void 0;t.Wl(3);break}return g.b(t,Do(X.J,L.downloadState,"mainVideoDownloadStateEntity"),4);case 4:d=t.G;case 3:h=d;if(!L||!h)return t.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));g.ZS(t,5);return g.b(t,OTG(X,n,h.addedTimestampMillis,(Y=g.T(c.actionMetadata,sy))==null?void 0:Y.offlineVideoData),7);case 7:H=1;H=Number(((a=
c.actionMetadata)==null?void 0:a.priority)||0)+1;A=tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n,"playbackData",H,lFA);g.vw(t,6);break;case 5:W=g.k1(t);if(!(W instanceof Error&&W.message==="No data")){if(W instanceof Error&&W.message==="Empty response body")V2(W.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",W instanceof g.ri&&W.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),t.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,w,F));t.Wl(6);break}return g.b(t,v$(X.J,n),9);case 9:Z=t.G;v=g.T(c.actionMetadata,sy);if(m=(e=v)==null?void 0:e.playlistId)Z.playlistId=m;Z.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.b(t,Zj(n,X.J,c,X.U,Z),6);case 6:return t.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,A?[A]:void 0))}})},fFk=function(X,c){var V,G,n,L,d,h,A,Y,H,a;
return g.O(function(W){switch(W.J){case 1:return V=hg(c),g.ZS(W,2),G=g.jE(c.entityKey).entityId,G==="!*$_ALL_ENTITIES_!*$"?g.b(W,EQ_(X.J,c,X.U,(H=c.actionMetadata)==null?void 0:(a=H.offlineLoggingData)==null?void 0:a.offlineDeleteReason),5):g.b(W,v$(X.J,G),6);case 6:n=W.G;L=g.T(c.actionMetadata,sy);if(h=(d=L)==null?void 0:d.playlistId)n.playlistId=h;n.offlineDeleteReason=(A=c.actionMetadata)==null?void 0:(Y=A.offlineLoggingData)==null?void 0:Y.offlineDeleteReason;return g.b(W,Zj(G,X.J,c,X.U,n),7);
case 7:if(!X.qW.S("woffle_enable_main_downloads_library")){W.Wl(5);break}return g.b(W,oQU(X.J,c.entityKey),5);case 5:g.vw(W,3);break;case 2:return g.k1(W),W.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V))}})},OTG=function(X,c,V,G,n){var L,d,h,A,Y,H;
return g.O(function(a){switch(a.J){case 1:if(L=G){a.Wl(2);break}return g.b(a,gQH([c]),3);case 3:d=a.G,L=d[0];case 2:return g.b(a,p6_(X,L,V,n),4);case 4:h=a.G;A=h.mainVideoEntity;Y=h.channelEntity;g.ZS(a,5);var W=W$(A.thumbnail),w=W$(Y.avatar);return g.b(a,Q2(W.concat(w)),7);case 7:g.vw(a,0);break;case 5:H=g.k1(a),H instanceof Error&&H.message==="Failed to fetch"&&V2(H.message),g.Ql(a)}})},p6_=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W,w,F,Z,v;
return g.O(function(e){switch(e.J){case 1:V||(V=Date.now().toString());L=(n=c.channel)==null?void 0:n.offlineChannelData;d={id:g.Hc(c.videoId,"ytMainChannelEntity"),channelId:L.channelId,title:L.title,avatar:L.thumbnail};h={key:g.Hc(c.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Hc(c.videoId,"playbackData"),addedTimestampMillis:V,videoDownloadContextEntity:g.Hc(c.videoId,"videoDownloadContextEntity")};A={key:g.Hc(c.videoId,"videoPlaybackPositionEntity"),videoId:c.videoId,lastPlaybackPositionSeconds:"0"};
X.qW.S("html5_offline_playback_position_sync")&&(Y={playbackPosition:A.key});H=g.Hc(c.videoId,"mainVideoEntity");a={key:H,videoId:c.videoId,title:c.title,thumbnail:c.thumbnail,localizedStrings:{viewCount:c.shortViewCountText},userState:Y,lengthSeconds:c.lengthSeconds?Number(c.lengthSeconds):void 0,publishedTimestampMillis:c.publishedTimestamp?(Number(c.publishedTimestamp)*1E3).toString():void 0,formattedDescription:c.description,owner:d.id,downloadState:h.key};if(!X.qW.S("woffle_enable_main_downloads_library")||
!G){e.Wl(2);break}return g.b(e,vQh(X.J,[H]),3);case 3:if(F=e.G)W=F.mainDownloadsLibraryEntity,w=F.mainDownloadsListEntity;case 2:return v=hUk,Z={key:g.Hc(c.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.z8(h,v,Z),g.b(e,K6(X.J,{mode:"readwrite",SS:!0},function(m){var t=u2(m,d,"ytMainChannelEntity"),f=u2(m,h,"mainVideoDownloadStateEntity"),U=u2(m,a,"mainVideoEntity");t=[t,f,U];X.qW.S("html5_offline_playback_position_sync")&&(f=u2(m,A,"videoPlaybackPositionEntity"),
t.push(f));W&&(f=u2(m,W,"mainDownloadsLibraryEntity"),t.push(f));w&&(f=u2(m,w,"mainDownloadsListEntity"),t.push(f));Z&&(m=u2(m,Z,"downloadStatusEntity"),t.push(m));return g.eA.all(t)}),4);
case 4:return e.return({mainVideoEntity:a,channelEntity:d})}})},IFH=function(X,c,V){this.J=X;
this.qW=c;this.U=V},UwG=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q;
return g.O(function(Q){switch(Q.J){case 1:return V=hg(c),G=[],g.b(Q,f6.getInstance(),2);case 2:n=Q.G;if(!n){Q.Wl(3);break}return g.b(Q,n.get("sdois"),4);case 4:return L=Q.G,g.b(Q,(h=n)==null?void 0:h.get("lmqf"),5);case 5:d=Q.G;case 3:g.ZS(Q,6);if(L===void 0)throw Error("prefStorage or opt-in state is undefined");A=[];if(L){Q.Wl(8);break}return g.b(Q,xPU(X.J),9);case 9:A=Q.G,A.reverse();case 8:if(!A.length){Q.Wl(10);break}Y=g.r(A);H=Y.next();case 11:if(H.done){Q.Wl(10);break}a=H.value;if(!a){Q.Wl(12);
break}W=g.jE(a).entityId;return g.b(Q,v$(X.J,W),14);case 14:return w=Q.G,w.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.b(Q,Zj(W,X.J,{entityKey:a,actionType:c.actionType},X.U,w),12);case 12:H=Y.next();Q.Wl(11);break;case 10:return g.b(Q,UP7(L,(F=d)!=null?F:"SD"),16);case 16:return Z=Q.G,g.b(Q,rez(Z),17);case 17:v=Zbr(Z);if(!X.qW.S("woffle_enable_main_downloads_library")){Q.Wl(18);break}if(L){Q.Wl(19);break}return g.b(Q,oQU(X.J,g.tJ),19);case 19:return g.b(Q,kSA(X.J,[g.tJ]),18);
case 18:if((e=v)==null?0:e.length)for(m=g.r(v),t=m.next();!t.done;t=m.next())if(U=f=t.value,C=U.actionType,K=U.entityKey,nj=U.actionMetadata,C&&K&&nj&&!g.T(nj,NIA)){C==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(nj.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(yl=g.T(f.actionMetadata,sy))yl.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",f.actionMetadata=Object.assign({},f.actionMetadata,{mainVideoEntityActionMetadata:yl});G.push(f)}g.vw(Q,7);break;
case 6:return Xl=g.k1(Q),u="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Xl instanceof g.ri&&Xl.type==="QUOTA_EXCEEDED"&&(u="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,u,q));case 7:return Q.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,G))}})},TIr=function(){z6.apply(this,arguments);
this.C="mainVideoEntity"},unV=function(X,c,V){c=c===void 0?43200:c;
V=V===void 0?!0:V;var G=G===void 0?!1:G;var n,L,d;return g.O(function(h){switch(h.J){case 1:if(!X.B.wJ())return h.return([]);n=[];g.ZS(h,2);return g.b(h,I0V(c,V,G),4);case 4:n=h.G;g.vw(h,3);break;case 2:L=g.k1(h),L instanceof Error&&L.message==="No data"||L instanceof Error&&L.message==="Empty response body"&&V2(L.message);case 3:return d=EDA(X,n,V,"mainPlaylistEntity"),h.return(d)}})},PbV=function(X,c,V,G){G=G===void 0?!1:G;
var n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m;return g.O(function(t){switch(t.J){case 1:return n=[],g.b(t,NzM(),2);case 2:return(L=t.G)||G?g.b(t,TzM(c,V),3):t.return([]);case 3:d=t.G;if((h=d)==null||!h.length)return t.return([]);A={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};Y=g.r(d);H=Y.next();case 4:if(H.done){t.Wl(6);break}W=a=H.value;w=W.actionType;F=W.entityKey;Z=W.actionMetadata;if(!(w&&F&&Z)||g.T(Z,NIA)){t.Wl(5);break}w==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Z.offlineLoggingData=
A);v=g.jE(F);e=v.entityId;return g.b(t,B$(X,[e],"mainVideoEntity",w,Z),8);case 8:m=t.G,n=n.concat(m);case 5:H=Y.next();t.Wl(4);break;case 6:return t.return(n)}})},zFp=function(X,c){this.J=X;
this.U=c},KoV=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e;
return g.O(function(m){switch(m.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,L=[],g.ZS(m,2),g.b(m,BIA(X,n),4);case 4:L=m.G;if((d=L)==null||!d.length){m.Wl(5);break}return g.b(m,bb7(X.J,c.entityKey),5);case 5:g.vw(m,3);break;case 2:return h=g.k1(m),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.ri&&h.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
m.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,A,Y));case 3:return H=[],g.b(m,Aet(X.J,"musicTrack",L),7);case 7:L=m.G;if(L.length)for(a=g.r(L),W=a.next();!W.done;W=a.next())if(w=W.value,F=w.offlineVideoData,Z=void 0,(Z=F)==null?0:Z.videoId)v=void 0,e=Number(((v=c.actionMetadata)==null?void 0:v.priority)||0)+1,H.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",e,CV,Jg(c,F,n)));return m.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,H))}})},
sbM=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R,l,p,cw,Lj,ds,M,jD,Fl,As,ts,$U,Ih,aR,zt,Nx,hi,O5,P1,Yb,up;
return g.O(function(UL){switch(UL.J){case 1:return V=hg(c),G=c.entityKey,n=g.jE(G).entityId,L=[],d=!1,n==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.b(UL,SJ(X.J,"musicAlbumRelease"),5)):g.b(UL,Do(X.J,G,"musicAlbumRelease"),4);case 4:(h=UL.G)&&L.push(h);UL.Wl(3);break;case 5:L=UL.G;case 3:if((A=L)==null||!A.length)return UL.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));if(d){Y=[];H=g.r(L);for(a=H.next();!a.done;a=H.next())W=a.value,w=g.jE(W.id).entityId,Y.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
w,"musicAlbumRelease",0,CV));return UL.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Y))}F=[];Z=L[0];v=void 0;if(!Z.downloadMetadata){UL.Wl(6);break}return g.b(UL,Do(X.J,Z.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:e=UL.G,v=Number((t=(m=e)==null?void 0:m.addedTimestampMillis)!=null?t:"0")/1E3;case 6:return g.ZS(UL,8),g.b(UL,BIA(X,n,(f=v)==null?void 0:f.toString()),10);case 10:F=UL.G;g.vw(UL,9);break;case 8:U=g.k1(UL);if(!(U instanceof Error&&U.message===
"No data")){if(U instanceof Error&&U.message==="Empty response body")V2(U.message);else return C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.ri&&U.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",K="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),UL.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,C,K));UL.Wl(9);break}return g.b(UL,o1(n,"musicAlbumRelease",X.J,
c,X.U),9);case 9:nj=[];yl=new Map;if((Xl=F)==null?0:Xl.length)for(u=g.r(F),q=u.next();!q.done;q=u.next())Q=q.value,P=Q.offlineVideoData,UD=void 0,((UD=P)==null?0:UD.videoId)&&yl.set(P.videoId,P);Zi=new Map;ah=[];if((Js=Z)==null?0:(SD=Js.tracks)==null?0:SD.length)for(Lt=g.r(Z.tracks),wM=Lt.next();!wM.done;wM=Lt.next())if(k=wM.value,J=g.jE(k).entityId)yl.has(J)?(Zi.set(J,yl.get(J)),yl.delete(J)):ah.push(J);l=Number(((R=c.actionMetadata)==null?void 0:R.priority)||0)+1;p=g.r(yl.entries());for(cw=p.next();!cw.done;cw=
p.next())Lj=cw.value,ds=g.r(Lj),M=ds.next().value,jD=ds.next().value,Fl=M,As=jD,nj.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Fl,"musicTrack",l,CV,Jg(c,As)));ts=g.r(Zi.entries());for($U=ts.next();!$U.done;$U=ts.next())Ih=$U.value,aR=g.r(Ih),zt=aR.next().value,Nx=aR.next().value,hi=zt,O5=Nx,nj.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",hi,"musicTrack",l,CV,Jg(c,O5)));P1=g.r(ah);for(Yb=P1.next();!Yb.done;Yb=P1.next())up=Yb.value,nj.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",up,
"musicTrack",0,CV));return UL.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,nj))}})},Cbt=function(X,c){var V,G;
return g.O(function(n){switch(n.J){case 1:return V=hg(c),g.ZS(n,2),G=g.jE(c.entityKey).entityId,G==="!*$_ALL_ENTITIES_!*$"?g.b(n,ee(X.J,c,X.U),5):g.b(n,o1(G,"musicAlbumRelease",X.J,c,X.U),6);case 6:return g.b(n,t8r(X.J,c.entityKey),5);case 5:g.vw(n,3);break;case 2:return g.k1(n),n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},BIA=function(X,c,V){var G,n,L;
return g.O(function(d){switch(d.J){case 1:return g.b(d,f0_([c]),2);case 2:return G=d.G,g.b(d,DwV(X,G[0],V),3);case 3:return n=d.G,L=W$(n.thumbnailDetails),g.b(d,Q2(L),4);case 4:return d.return(G[0].videos)}})},DwV=function(X,c,V){var G,n,L,d,h,A,Y,H,a,W,w,F,Z,v;
return g.O(function(e){if(e.J==1){G=c.additionalMetadadatas;n=void 0;if(G&&G.length>0)for(L=g.r(G),d=L.next();!d.done;d=L.next())if(h=d.value,h.offlineMusicPlaylistData){n=h.offlineMusicPlaylistData;break}A=c.playlistId;Y=Obi(c);H=Y.Qy;a=Y.tG;W=V?(Number(V)*1E3).toString():Date.now().toString();w=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0";F={id:g.Hc(A,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:a,lastModifiedTimestampMillis:w,addedTimestampMillis:W,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Z={id:g.Hc(A,"musicAlbumRelease"),title:c.title,audioPlaylistId:A,trackCount:c.totalVideoCount,tracks:H,downloadMetadata:F.id};n&&(Z.thumbnailDetails=(v=n.albumHqThumbnail)!=null?v:n.albumArtistThumbnail,Z.artistDisplayName=n.albumArtistDisplayName,Z.releaseDate=n.albumReleaseDate,Z.contentRating={explicitType:n.albumReleaseExplicitType},Z.releaseType=n.albumReleaseType);return g.b(e,K6(X.J,{mode:"readwrite",SS:!0},function(m){var t=u2(m,Z,"musicAlbumRelease");
m=u2(m,F,"musicAlbumReleaseDownloadMetadataEntity");return g.eA.all([t,m])}),2)}return e.return(Z)})},Sv7=function(X,c){this.J=X;
this.U=c},qvh=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e;
return g.O(function(m){switch(m.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,L=[],g.ZS(m,2),g.b(m,iTA(X,n),4);case 4:L=m.G;if((d=L)==null||!d.length){m.Wl(5);break}return g.b(m,bb7(X.J,c.entityKey),5);case 5:g.vw(m,3);break;case 2:return h=g.k1(m),A="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",h instanceof g.ri&&h.type==="QUOTA_EXCEEDED"&&(A="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Y="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
m.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,A,Y));case 3:return H=[],g.b(m,Aet(X.J,"musicTrack",L),7);case 7:L=m.G;if(L.length)for(a=g.r(L),W=a.next();!W.done;W=a.next())if(w=W.value,F=w.offlineVideoData,Z=void 0,(Z=F)==null?0:Z.videoId)v=void 0,e=Number(((v=c.actionMetadata)==null?void 0:v.priority)||0)+1,H.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",F.videoId,"musicTrack",e,Dj,Jg(c,F,n)));return m.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,H))}})},
XA_=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM,k,J,R,l,p,cw,Lj,ds,M,jD,Fl,As,ts,$U,Ih,aR,zt,Nx,hi,O5,P1,Yb,up,UL,PW,rW,j9,R3,aA,bP,lm,MX,oj,iu,zv;
return g.O(function(Go){switch(Go.J){case 1:return V=hg(c),G=c.entityKey,n=g.jE(G).entityId,L=[],d=!1,n==="!*$_ALL_ENTITIES_!*$"?(d=!0,g.b(Go,SJ(X.J,"musicPlaylist"),5)):g.b(Go,Do(X.J,G,"musicPlaylist"),4);case 4:(h=Go.G)&&L.push(h);Go.Wl(3);break;case 5:L=Go.G;case 3:if((A=L)==null||!A.length)return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Y=g.T(c.actionMetadata,l0r);a=(H=Y)==null?void 0:H.autoSync;W=[];F=w=!0;Z=!1;v=void 0;if(!d&&a===!1){Go.Wl(6);break}g.ZS(Go,7);return g.b(Go,
uGG(0,!!a,!0,L),9);case 9:W=Go.G;g.vw(Go,8);break;case 7:e=g.k1(Go);if(!(e instanceof Error&&e.message==="No data")){e instanceof Error&&e.message==="Empty response body"&&V2(e.message);Go.Wl(8);break}return n==="!*$_ALL_ENTITIES_!*$"?g.b(Go,ee(X.J,c,X.U),8):g.b(Go,o1(n,"musicPlaylist",X.J,c,X.U),8);case 8:if(!W.length||!d&&W[0].playlistId!==n)return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));case 6:if(d){m=[];t=g.r(W);for(f=t.next();!f.done;f=t.next())U=f.value,U.upToDate||
a&&!U.shouldAutoSyncMetadata||!U.playlistId||(C={autoSync:a},m.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"musicPlaylist",0,Dj,{musicPlaylistEntityActionMetadata:C})));return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,m))}W.length&&(K=W[0],Z=!!K.upToDate,a&&(w=(nj=K.shouldAutoSyncMetadata)!=null?nj:!0,F=(yl=K.shouldAutoSyncVideos)!=null?yl:!0,K.checkInSeconds&&(v=K.checkInSeconds)));if(Z||!w)return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));Xl=[];u=L[0];q=void 0;if(!u.downloadMetadata){Go.Wl(15);break}return g.b(Go,Do(X.J,u.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Q=Go.G,q=Number((UD=(P=Q)==null?void 0:P.addedTimestampMillis)!=null?UD:"0")/1E3;case 15:return g.ZS(Go,17),g.b(Go,iTA(X,n,(Zi=q)==null?void 0:Zi.toString(),v),19);case 19:Xl=Go.G;g.vw(Go,18);break;case 17:ah=g.k1(Go);if(!(ah instanceof Error&&ah.message==="No data")){if(ah instanceof Error&&ah.message==="Empty response body")V2(ah.message);else return Js=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",SD="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ah instanceof g.ri&&ah.type==="QUOTA_EXCEEDED"&&(Js="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",SD="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,Js,SD));Go.Wl(18);break}return g.b(Go,o1(n,"musicPlaylist",X.J,c,X.U),18);case 18:if(!F)return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V));Lt=[];wM=new Map;if((k=Xl)==null?0:k.length)for(J=g.r(Xl),R=J.next();!R.done;R=J.next())l=R.value,p=l.offlineVideoData,cw=void 0,((cw=p)==null?0:cw.videoId)&&wM.set(p.videoId,p);Lj=new Map;ds=[];if((M=u)==null?0:(jD=M.tracks)==null?0:jD.length)for(Fl=g.r(u.tracks),As=Fl.next();!As.done;As=Fl.next())if(ts=As.value,$U=g.jE(ts).entityId)wM.has($U)?(Lj.set($U,wM.get($U)),wM.delete($U)):ds.push($U);aR=Number(((Ih=c.actionMetadata)==null?void 0:Ih.priority)||0)+1;zt=g.r(wM.entries());for(Nx=zt.next();!Nx.done;Nx=
zt.next())hi=Nx.value,O5=g.r(hi),P1=O5.next().value,Yb=O5.next().value,up=P1,UL=Yb,Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",up,"musicTrack",aR,Dj,Jg(c,UL)));PW=g.r(Lj.entries());for(rW=PW.next();!rW.done;rW=PW.next())j9=rW.value,R3=g.r(j9),aA=R3.next().value,bP=R3.next().value,lm=aA,MX=bP,Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",lm,"musicTrack",aR,Dj,Jg(c,MX)));oj=g.r(ds);for(iu=oj.next();!iu.done;iu=oj.next())zv=iu.value,Lt.push(tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
zv,"musicTrack",0,Dj));return Go.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,Lt))}})},cLk=function(X,c){var V,G;
return g.O(function(n){switch(n.J){case 1:return V=hg(c),g.ZS(n,2),G=g.jE(c.entityKey).entityId,G==="!*$_ALL_ENTITIES_!*$"?g.b(n,ee(X.J,c,X.U),5):g.b(n,o1(G,"musicPlaylist",X.J,c,X.U),6);case 6:return g.b(n,t8r(X.J,c.entityKey),5);case 5:g.vw(n,3);break;case 2:return g.k1(n),n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},iTA=function(X,c,V,G){var n,L,d;
return g.O(function(h){switch(h.J){case 1:return g.b(h,f0_([c]),2);case 2:return n=h.G,g.b(h,V7z(X,n[0],V,G),3);case 3:return L=h.G,d=W$(L.thumbnailDetails),g.b(h,Q2(d),4);case 4:return h.return(n[0].videos)}})},V7z=function(X,c,V,G){var n,L,d,h,A,Y,H,a,W;
return g.O(function(w){return w.J==1?(n=c.playlistId,L=Obi(c),d=L.Qy,h=L.tG,A=V?(Number(V)*1E3).toString():Date.now().toString(),Y=c.lastModifiedTimestamp?(Number(c.lastModifiedTimestamp)*1E3).toString():"0",H={id:g.Hc(n,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:h,lastModifiedTimestampMillis:Y,addedTimestampMillis:A,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},a={id:g.Hc(n,"musicPlaylist"),title:c.title,playlistId:n,thumbnailDetails:c.thumbnail,visibility:GIh(c),trackCount:c.totalVideoCount,
tracks:d,downloadMetadata:H.id},G&&(((W=a)==null?0:W.entityMetadata)?a.entityMetadata.nextAutoRefreshIntervalSeconds=String(G):a&&(a.entityMetadata={nextAutoRefreshIntervalSeconds:String(G)})),g.b(w,K6(X.J,{mode:"readwrite",SS:!0},function(F){var Z=u2(F,a,"musicPlaylist");F=u2(F,H,"musicPlaylistDownloadMetadataEntity");return g.eA.all([Z,F])}),2)):w.return(a)})},GIh=function(X){switch(X.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},nfA=function(X,c){this.J=X;
this.U=c},hgz=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F;
return g.O(function(Z){switch(Z.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,L=g.T(c.actionMetadata,LXM),g.ZS(Z,2),g.b(Z,dKG(X,n,void 0,(d=L)==null?void 0:d.track,(h=L)==null?void 0:h.albumRelease),4);case 4:if((A=L)==null?0:A.playlistId){Z.Wl(5);break}return g.b(Z,bb7(X.J,c.entityKey),5);case 5:g.vw(Z,3);break;case 2:return Y=g.k1(Z),H="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Y instanceof g.ri&&Y.type==="QUOTA_EXCEEDED"&&
(H="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",a="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Z.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,H,a));case 3:w=Number(((W=c.actionMetadata)==null?void 0:W.priority)||0)+1;var v=(v=g.T(c.actionMetadata,LXM))?{playbackDataActionMetadata:{maximumDownloadQuality:v.maximumDownloadQuality}}:void 0;F=tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n,"playbackData",w,yLi,v);return Z.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V,[F]))}})},ALh=function(X,c){var V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v;
return g.O(function(e){switch(e.J){case 1:return V=hg(c),G=g.jE(c.entityKey),n=G.entityId,g.b(e,Do(X.J,c.entityKey,"musicTrack"),2);case 2:L=e.G;if(!L){d=void 0;e.Wl(3);break}return g.b(e,Do(X.J,L.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:d=e.G;case 3:h=d;if(!L||!h)return e.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V));Y=g.T(c.actionMetadata,LXM);g.ZS(e,5);return g.b(e,dKG(X,n,h.addedTimestampMillis,(H=Y)==null?void 0:H.track,(a=Y)==null?void 0:a.albumRelease),
7);case 7:w=Number(((W=c.actionMetadata)==null?void 0:W.priority)||0)+1;A=tg("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",n,"playbackData",w,yLi);g.vw(e,6);break;case 5:F=g.k1(e);if(!(F instanceof Error&&F.message==="No data")){if(F instanceof Error&&F.message==="Empty response body")V2(F.message);else return Z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",v="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.ri&&F.type==="QUOTA_EXCEEDED"&&(Z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
v="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),e.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,Z,v));e.Wl(6);break}return g.b(e,ko(n,X.J,c,X.U),6);case 6:return e.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",V,A?[A]:void 0))}})},YaV=function(X,c){var V,G;
return g.O(function(n){switch(n.J){case 1:return V=hg(c),g.ZS(n,2),G=g.jE(c.entityKey).entityId,G==="!*$_ALL_ENTITIES_!*$"?g.b(n,ee(X.J,c,X.U),5):g.b(n,ko(G,X.J,c,X.U),6);case 6:return g.b(n,t8r(X.J,c.entityKey),5);case 5:g.vw(n,3);break;case 2:return g.k1(n),n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",V,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return n.return(new Oy("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
V))}})},dKG=function(X,c,V,G,n){var L,d,h,A,Y,H;
return g.O(function(a){switch(a.J){case 1:if(L=G){a.Wl(2);break}return g.b(a,gQH([c]),3);case 3:d=a.G,h=d[0],L=RUp(h);case 2:return g.b(a,jLA(X,L,c,n,V),4);case 4:A=a.G;Y=A.musicTrackEntity;H=A.zt;var W=W$(Y.thumbnailDetails),w=[];H&&(w=W$(H.thumbnailDetails));return g.b(a,Q2(W.concat(w)),0)}})},jLA=function(X,c,V,G,n){var L;
return g.O(function(d){return d.J==1?(n||(n=Date.now().toString()),L={id:g.Hc(V,"musicTrackDownloadMetadataEntity"),playbackData:g.Hc(V,"playbackData"),addedTimestampMillis:n,videoDownloadContextEntity:g.Hc(V,"videoDownloadContextEntity")},G&&(c.albumRelease=G.id),g.b(d,K6(X.J,{mode:"readwrite",SS:!0},function(h){var A=[],Y=u2(h,L,"musicTrackDownloadMetadataEntity");A.push(Y);Y=u2(h,c,"musicTrack");A.push(Y);G&&(h=u2(h,G,"musicAlbumRelease"),A.push(h));return g.eA.all(A)}),2)):d.J!=3?g.b(d,H$(V,"musicTrackDownloadMetadataEntity",
X.J,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):d.return({musicTrackEntity:c,
zt:G})})},Se=function(){z6.apply(this,arguments);
this.C="musicTrack"},HKp=function(X,c,V){c=c===void 0?43200:c;
V=V===void 0?!0:V;var G=G===void 0?!1:G;var n,L;return g.O(function(d){switch(d.J){case 1:if(!X.B.wJ())return d.return([]);n=[];g.ZS(d,2);return g.b(d,uGG(c,V,G),4);case 4:n=d.G;g.vw(d,3);break;case 2:g.k1(d);case 3:return L=EDA(X,n,V,"musicPlaylist"),d.return(L)}})},aPp=function(){g.wh.apply(this,arguments);
var X=this;this.events=new g.N_(this);this.qW=this.player.j();this.F8={AQ7:function(){return X.J},
F$:function(){return X.F$()},
ex:function(c){return X.ex(c)}}},$KU=function(X){var c;
X=g.T((c=X.getWatchNextResponse())==null?void 0:c.currentVideoEndpoint,g.ij);if(X==null?0:X.playlistId)var V=X.playlistId;return V},WXr=function(X,c){var V,G,n,L;
return g.O(function(d){if(d.J==1){V=c.clientPlaybackNonce;G={cpn:V,offlineSourceVisualElement:g.JU(c.Pl||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};c.G&&(G.videoFmt=Number(c.G.itag));c.X&&(G.audioFmt=Number(c.X.itag));if((n=$KU(c))&&c.videoId){var h=c.videoId;h=n!=="PPSV"?Promise.resolve(!1):X.J.ZK(h);d=g.b(d,h,3)}else d=d.Wl(2);return d}d.J!=2&&(L=d.G)&&(G.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");X.G=V;g.H8("offlinePlaybackStarted",G);g.Ql(d)})};
g.ox.prototype.vU=g.Gt(51,function(X){return this.app.vU(X)});
g.Wn.prototype.vU=g.Gt(50,function(X){return g.uL1(this,9,X)});
g.E(MW,l2);g.hs.Object.defineProperties(MW.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.J.entityMetadata},
set:function(X){this.J.entityMetadata=X}}});
g.E(Y2z,MW);Y2z.prototype.G=function(){return[]};
g.E(jnM,MW);jnM.prototype.G=function(){return[]};
g.E(Hct,MW);Hct.prototype.G=function(){return[]};
g.E(a4A,MW);a4A.prototype.G=function(){return[]};
g.E($Xi,MW);$Xi.prototype.G=function(){var X=[];this.J.alternateChannel&&X.push(this.J.alternateChannel);this.J.alternateChannelList&&X.push.apply(X,g.x(this.J.alternateChannelList));this.J.oneofChannelEntity&&X.push(this.J.oneofChannelEntity);return[].concat(g.x(new Set(X)))};
g.E(WYr,MW);WYr.prototype.G=function(){var X=[];this.J.entryCollection&&X.push(this.J.entryCollection);return[].concat(g.x(new Set(X)))};
g.E(w0G,l2);w0G.prototype.G=function(){var X=[];this.J.video&&X.push(this.J.video);return[].concat(g.x(new Set(X)))};
g.E(FYh,MW);FYh.prototype.G=function(){var X=[];this.J.parentPlaylist&&X.push(this.J.parentPlaylist);if(this.J.entries)for(var c=g.r(this.J.entries),V=c.next();!V.done;V=c.next())X.push.apply(X,g.x((new w0G(V.value)).G()));return[].concat(g.x(new Set(X)))};
g.E(Es7,MW);Es7.prototype.G=function(){var X=[];this.J.descriptionEntity&&X.push(this.J.descriptionEntity);this.J.creators&&X.push.apply(X,g.x(this.J.creators));this.J.theBiggestFan&&X.push(this.J.theBiggestFan);return[].concat(g.x(new Set(X)))};
g.E(rWz,MW);rWz.prototype.G=function(){return[]};
g.E(Qnr,MW);Qnr.prototype.G=function(){return[]};
g.E(ZcM,MW);ZcM.prototype.G=function(){return[]};
g.E(xXh,MW);xXh.prototype.G=function(){return[]};
g.E(vsA,MW);vsA.prototype.G=function(){return[]};
g.E(kap,MW);kap.prototype.G=function(){return[]};
g.E(osp,MW);osp.prototype.G=function(){return[]};
g.E(eCV,MW);eCV.prototype.G=function(){return[]};
g.E(JWk,MW);JWk.prototype.G=function(){return[]};
g.E(mXG,MW);mXG.prototype.G=function(){var X=[];this.J.downloadsList&&X.push(this.J.downloadsList);this.J.smartDownloadsList&&X.push(this.J.smartDownloadsList);this.J.recommendedDownloadsList&&X.push(this.J.recommendedDownloadsList);this.J.refresh&&X.push(this.J.refresh);return[].concat(g.x(new Set(X)))};
g.E(RCV,l2);RCV.prototype.G=function(){var X=[];this.J.video&&X.push(this.J.video);this.J.playlist&&X.push(this.J.playlist);this.J.videoItem&&X.push(this.J.videoItem);this.J.playlistItem&&X.push(this.J.playlistItem);return[].concat(g.x(new Set(X)))};
g.E(bcz,MW);bcz.prototype.G=function(){var X=[];this.J.refresh&&X.push(this.J.refresh);if(this.J.downloads)for(var c=g.r(this.J.downloads),V=c.next();!V.done;V=c.next())X.push.apply(X,g.x((new RCV(V.value)).G()));return[].concat(g.x(new Set(X)))};
g.E(tGt,MW);tGt.prototype.G=function(){var X=[];this.J.localImageEntities&&X.push.apply(X,g.x(this.J.localImageEntities));return[].concat(g.x(new Set(X)))};
g.E(OcG,MW);OcG.prototype.G=function(){var X=[];this.J.playbackData&&X.push(this.J.playbackData);this.J.localImageEntities&&X.push.apply(X,g.x(this.J.localImageEntities));this.J.videoDownloadContextEntity&&X.push(this.J.videoDownloadContextEntity);return[].concat(g.x(new Set(X)))};
g.E(l4A,MW);l4A.prototype.G=function(){return[]};
g.E(MGz,MW);MGz.prototype.G=function(){var X=[];this.J.fakeChildren&&X.push.apply(X,g.x(this.J.fakeChildren));return[].concat(g.x(new Set(X)))};
g.E(gsz,MW);gsz.prototype.G=function(){var X=[];this.J.video&&X.push(this.J.video);this.J.playbackData&&X.push(this.J.playbackData);this.J.offlineVideoPolicy&&X.push(this.J.offlineVideoPolicy);return[].concat(g.x(new Set(X)))};
g.E(f4U,MW);f4U.prototype.G=function(){return[]};
g.E(p0G,MW);p0G.prototype.G=function(){var X=[];this.J.channelOwner&&X.push(this.J.channelOwner);this.J.videos&&X.push.apply(X,g.x(this.J.videos));this.J.collaboratorChannels&&X.push.apply(X,g.x(this.J.collaboratorChannels));this.J.downloadState&&X.push(this.J.downloadState);this.J.refresh&&X.push(this.J.refresh);return[].concat(g.x(new Set(X)))};
g.E(I4z,MW);I4z.prototype.G=function(){var X=[];this.J.video&&X.push(this.J.video);this.J.channelContributor&&X.push(this.J.channelContributor);return[].concat(g.x(new Set(X)))};
g.E(N6H,l2);N6H.prototype.G=function(){var X=[];this.J.localImageEntities&&X.push.apply(X,g.x(this.J.localImageEntities));this.J.videoDownloadContextEntity&&X.push(this.J.videoDownloadContextEntity);return[].concat(g.x(new Set(X)))};
g.E(UX7,l2);UX7.prototype.G=function(){var X=[];this.J.recommendedVideoMetadata&&X.push.apply(X,g.x((new N6H(this.J.recommendedVideoMetadata)).G()));return[].concat(g.x(new Set(X)))};
g.E(T6i,l2);T6i.prototype.G=function(){var X=[];this.J.playbackPosition&&X.push(this.J.playbackPosition);return[].concat(g.x(new Set(X)))};
g.E(u9V,MW);u9V.prototype.G=function(){var X=[];this.J.owner&&X.push(this.J.owner);this.J.downloadState&&X.push(this.J.downloadState);this.J.userState&&X.push.apply(X,g.x((new T6i(this.J.userState)).G()));this.J.additionalMetadata&&X.push.apply(X,g.x((new UX7(this.J.additionalMetadata)).G()));return[].concat(g.x(new Set(X)))};
g.E(PmV,MW);PmV.prototype.G=function(){var X=[];this.J.userChannelDetails&&X.push(this.J.userChannelDetails);return[].concat(g.x(new Set(X)))};
g.E(zCH,MW);zCH.prototype.G=function(){var X=[];this.J.channelOwner&&X.push(this.J.channelOwner);this.J.playbackPosition&&X.push(this.J.playbackPosition);this.J.localImageEntities&&X.push.apply(X,g.x(this.J.localImageEntities));this.J.downloadStatus&&X.push(this.J.downloadStatus);return[].concat(g.x(new Set(X)))};
g.E(B6r,MW);B6r.prototype.G=function(){return[]};
g.E(KYA,MW);KYA.prototype.G=function(){return[]};
g.E(snh,MW);snh.prototype.G=function(){return[]};
g.E(Cmk,MW);Cmk.prototype.G=function(){return[]};
g.E(DXU,MW);DXU.prototype.G=function(){return[]};
g.E(S2G,MW);S2G.prototype.G=function(){return[]};
g.E(icM,MW);icM.prototype.G=function(){return[]};
g.E(q2h,MW);q2h.prototype.G=function(){return[]};
g.E(XFt,MW);XFt.prototype.G=function(){return[]};
g.E(ckA,MW);ckA.prototype.G=function(){return[]};
g.E(VyV,MW);VyV.prototype.G=function(){return[]};
g.E(Gq_,MW);Gq_.prototype.G=function(){var X=[];this.J.trackDownloadMetadatas&&X.push.apply(X,g.x(this.J.trackDownloadMetadatas));return[].concat(g.x(new Set(X)))};
g.E(nrh,MW);
nrh.prototype.G=function(){var X=[];this.J.downloadedTracks&&X.push.apply(X,g.x(this.J.downloadedTracks));this.J.smartDownloadedTracks&&X.push.apply(X,g.x(this.J.smartDownloadedTracks));this.J.downloadedEpisodes&&X.push.apply(X,g.x(this.J.downloadedEpisodes));this.J.downloadedAlbumReleases&&X.push.apply(X,g.x(this.J.downloadedAlbumReleases));this.J.smartDownloadedAlbumReleases&&X.push.apply(X,g.x(this.J.smartDownloadedAlbumReleases));this.J.downloadedPlaylists&&X.push.apply(X,g.x(this.J.downloadedPlaylists));this.J.smartDownloadedPlaylists&&
X.push.apply(X,g.x(this.J.smartDownloadedPlaylists));this.J.metadataOnlyTracks&&X.push.apply(X,g.x(this.J.metadataOnlyTracks));return[].concat(g.x(new Set(X)))};
g.E(LiV,MW);LiV.prototype.G=function(){var X=[];this.J.trackDownloadMetadatas&&X.push.apply(X,g.x(this.J.trackDownloadMetadatas));return[].concat(g.x(new Set(X)))};
g.E(dvk,MW);dvk.prototype.G=function(){var X=[];this.J.playbackData&&X.push(this.J.playbackData);this.J.localImageEntities&&X.push.apply(X,g.x(this.J.localImageEntities));this.J.videoDownloadContextEntity&&X.push(this.J.videoDownloadContextEntity);return[].concat(g.x(new Set(X)))};
g.E(ykM,MW);ykM.prototype.G=function(){var X=[];this.J.musicLibraryStatusEntity&&X.push(this.J.musicLibraryStatusEntity);this.J.primaryArtists&&X.push.apply(X,g.x(this.J.primaryArtists));this.J.details&&X.push(this.J.details);this.J.userDetails&&X.push(this.J.userDetails);this.J.tracks&&X.push.apply(X,g.x(this.J.tracks));this.J.share&&X.push(this.J.share);this.J.downloadMetadata&&X.push(this.J.downloadMetadata);this.J.refresh&&X.push(this.J.refresh);return[].concat(g.x(new Set(X)))};
g.E(haH,MW);haH.prototype.G=function(){var X=[];this.J.albumRelease&&X.push(this.J.albumRelease);this.J.tracks&&X.push.apply(X,g.x(this.J.tracks));return[].concat(g.x(new Set(X)))};
g.E(Ak_,MW);Ak_.prototype.G=function(){var X=[];this.J.albumRelease&&X.push(this.J.albumRelease);return[].concat(g.x(new Set(X)))};
g.E(YAi,MW);YAi.prototype.G=function(){var X=[];this.J.details&&X.push(this.J.details);this.J.userDetails&&X.push(this.J.userDetails);return[].concat(g.x(new Set(X)))};
g.E(jtk,MW);jtk.prototype.G=function(){var X=[];this.J.parentArtist&&X.push(this.J.parentArtist);return[].concat(g.x(new Set(X)))};
g.E(HN7,MW);HN7.prototype.G=function(){var X=[];this.J.parentArtist&&X.push(this.J.parentArtist);return[].concat(g.x(new Set(X)))};
g.E(awz,MW);awz.prototype.G=function(){return[]};
g.E($vi,MW);$vi.prototype.G=function(){return[]};
g.E(Wi7,l2);Wi7.prototype.G=function(){var X=[];this.J.creatorEntity&&X.push(this.J.creatorEntity);return[].concat(g.x(new Set(X)))};
g.E(wF7,MW);
wF7.prototype.G=function(){var X=[];this.J.tracks&&X.push.apply(X,g.x(this.J.tracks));this.J.refresh&&X.push(this.J.refresh);this.J.musicLibraryStatusEntity&&X.push(this.J.musicLibraryStatusEntity);this.J.details&&X.push(this.J.details);this.J.downloadMetadata&&X.push(this.J.downloadMetadata);this.J.sideloadMetadata&&X.push(this.J.sideloadMetadata);this.J.userDetails&&X.push(this.J.userDetails);this.J.entryCollection&&X.push(this.J.entryCollection);this.J.share&&X.push(this.J.share);this.J.podcastShowAdditionalMetadata&&X.push.apply(X,
g.x((new Wi7(this.J.podcastShowAdditionalMetadata)).G()));return[].concat(g.x(new Set(X)))};
g.E(FiA,MW);FiA.prototype.G=function(){return[]};
g.E(Erp,MW);
Erp.prototype.G=function(){var X=[];this.J.musicLibraryStatusEntity&&X.push(this.J.musicLibraryStatusEntity);this.J.artists&&X.push.apply(X,g.x(this.J.artists));this.J.audioModeVersion&&X.push(this.J.audioModeVersion);this.J.videoModeVersion&&X.push(this.J.videoModeVersion);this.J.userDetails&&X.push(this.J.userDetails);this.J.details&&X.push(this.J.details);this.J.albumRelease&&X.push(this.J.albumRelease);this.J.share&&X.push(this.J.share);this.J.libraryEdit&&X.push(this.J.libraryEdit);this.J.downloadMetadata&&
X.push(this.J.downloadMetadata);this.J.playbackPosition&&X.push(this.J.playbackPosition);this.J.lyrics&&X.push(this.J.lyrics);return[].concat(g.x(new Set(X)))};
g.E(rkA,MW);rkA.prototype.G=function(){var X=[];this.J.parentTrack&&X.push(this.J.parentTrack);return[].concat(g.x(new Set(X)))};
g.E(QtG,MW);QtG.prototype.G=function(){var X=[];this.J.parentTrack&&X.push(this.J.parentTrack);return[].concat(g.x(new Set(X)))};
g.E(ZNV,MW);ZNV.prototype.G=function(){return[]};
g.E(xvV,MW);xvV.prototype.G=function(){return[]};
g.E(vrz,MW);vrz.prototype.G=function(){return[]};
g.E(kq_,MW);kq_.prototype.G=function(){return[]};
g.E(orM,MW);orM.prototype.G=function(){var X=[];this.J.transfer&&X.push(this.J.transfer);this.J.adsPlaybackData&&X.push.apply(X,g.x(this.J.adsPlaybackData));this.J.drmLicense&&X.push(this.J.drmLicense);this.J.offlineVideoPolicy&&X.push(this.J.offlineVideoPolicy);this.J.videoDownloadContextEntity&&X.push(this.J.videoDownloadContextEntity);return[].concat(g.x(new Set(X)))};
g.E(eaV,MW);eaV.prototype.G=function(){return[]};
g.E(Jkh,MW);Jkh.prototype.G=function(){var X=[];this.J.offlineVideoStreams&&X.push.apply(X,g.x(this.J.offlineVideoStreams));this.J.captionTrack&&X.push.apply(X,g.x(this.J.captionTrack));return[].concat(g.x(new Set(X)))};
g.E(mvA,MW);mvA.prototype.G=function(){return[]};
g.E(Raz,MW);Raz.prototype.G=function(){return[]};
g.E(bNV,MW);bNV.prototype.G=function(){return[]};
g.E(tyU,MW);tyU.prototype.G=function(){return[]};
g.E(ONV,MW);ONV.prototype.G=function(){return[]};
g.E(lw7,MW);lw7.prototype.G=function(){return[]};
g.E(MyA,MW);MyA.prototype.G=function(){return[]};
g.E(grh,MW);grh.prototype.G=function(){return[]};
g.E(fwA,MW);fwA.prototype.G=function(){return[]};
g.E(pFp,MW);pFp.prototype.G=function(){return[]};
g.E(IwA,MW);IwA.prototype.G=function(){return[]};
g.E(NTt,MW);NTt.prototype.G=function(){return[]};
g.E(UvU,MW);UvU.prototype.G=function(){return[]};
g.E(TTM,MW);TTM.prototype.G=function(){return[]};
g.E(uyk,MW);uyk.prototype.G=function(){return[]};
g.E(P0t,MW);P0t.prototype.G=function(){return[]};
g.E(zap,MW);zap.prototype.G=function(){return[]};
g.E(BTt,MW);BTt.prototype.G=function(){return[]};
g.E(KiA,MW);KiA.prototype.G=function(){return[]};
var Pv_=["browse","music/browse","unplugged/browse"],CvA=["offline/playlist_sync_check"],M8H=["offline"],zUr=["offline/offline_video_playback_position_sync"],KhU=["offline/get_playback_data_entity"],gX;f6.getInstance=function(){return g.O(function(X){return X.return(new Promise(function(c){g.V5().then(function(V){V?(f6.instance||(f6.instance=new f6(V)),c(f6.instance)):c(void 0)})}))})};
f6.prototype.get=function(X){var c=this,V,G,n;return g.O(function(L){if(L.J==1)return g.b(L,SAi(c.token),2);if(L.J!=3)return V=L.G,g.b(L,V.get("prefs",X),3);G=L.G;if(!G)return L.return();n=(0,g.bE)();return G.expirationTimestampMs<=n?L.return():L.return(G.value)})};
f6.prototype.set=function(X,c,V){V=V===void 0?31536E3:V;var G=this,n,L,d;return g.O(function(h){if(h.J==1)return n=(0,g.bE)(),L={key:X,value:c,expirationTimestampMs:n+V*1E3},g.b(h,SAi(G.token),2);d=h.G;return g.b(h,g.f$(d,"prefs",L),0)})};
f6.prototype.remove=function(X){var c=this,V;return g.O(function(G){if(G.J==1)return g.b(G,SAi(c.token),2);V=G.G;return g.b(G,V.delete("prefs",X),0)})};
g.E(p6,g.Dh);g.E(If,VFz);If.prototype.U=function(X,c){c=nvU(c);X=(new TextEncoder).encode(JSON.stringify(X));return this.J.encrypt(X,c)};
If.prototype.G=function(X,c){if(!(X instanceof Uint8Array))throw iNA(1);var V=new TextDecoder;c=nvU(c);X=this.J.decrypt(X,c);return JSON.parse(V.decode(X))};
var Lnk={accountLinkStatusEntity:ZcM,booleanEntity:Hct,buttonEntity:NTt,captionTrack:ZNV,channelHandle:Y2z,commerceAcquisitionClientPayloadEntity:TTM,commerceCartListEntity:uyk,contextNoteFeedEntityPayload:jnM,continuationTokenEntity:f4U,downloadQualityPickerEntity:osp,downloadsPageRefreshTokenEntity:JWk,downloadsPageViewConfigurationEntity:B6r,downloadStatusEntity:eCV,dismissState:lw7,sfvAudioItemCurrentlyPlayingEntity:bNV,emojiFountainDataEntity:pFp,emojiCustomizationSetEntity:fwA,fakeChannel:$Xi,
fakePlaylist:WYr,fakePlaylistEntryCollection:FYh,fakeVideo:Es7,fakeVideoDescription:rWz,featuredProductsEntity:XFt,flowStateEntity:Qnr,iconBadgeEntity:P0t,interstitialInteractionStateEntity:vsA,likeButtonAnimationEntity:KYA,liveChatPollStateEntity:kap,liveViewerLeaderboardPointsEntity:Raz,liveReactionsDataEntity:IwA,logoEntity:xXh,macroMarkerEntity:snh,mainDownloadsLibraryEntity:mXG,mainDownloadsListEntity:bcz,mainPlaylistDownloadStateEntity:tGt,mainPlaylistEntity:p0G,mainPlaylistVideoEntity:I4z,
mainVideoDownloadStateEntity:OcG,mainVideoEntity:u9V,markersEngagementPanelSyncEntity:Cmk,markersVisibilityOverrideEntity:DXU,musicAlbumReleaseDetail:haH,musicAlbumReleaseDownloadMetadataEntity:Gq_,musicAlbumRelease:ykM,musicAlbumReleaseUserDetail:Ak_,musicArtistDetail:jtk,musicArtist:YAi,musicArtistUserDetail:HN7,musicDownloadsLibraryEntity:nrh,musicLibraryEdit:awz,musicLibraryStatusEntity:$vi,musicPlaylist:wF7,musicPlaylistDownloadMetadataEntity:LiV,musicShare:FiA,musicTrackDetail:rkA,musicTrackDownloadMetadataEntity:dvk,
musicTrack:Erp,musicTrackUserDetail:QtG,offlineOrchestrationActionWrapperEntity:xvV,offlineVideoPolicy:vrz,offlineVideoStreams:kq_,offlineabilityEntity:l4A,orchestrationWebSamplingEntity:MGz,pageHeaderEntity:MyA,pdpStateEntity:zap,pinnedProductEntity:ckA,playbackData:orM,playerStateEntity:S2G,quantityIncrementerEntity:BTt,refresh:eaV,saveToPlaylistListEntity:tyU,settingEntity:ONV,stringEntity:a4A,suggestedFeedbackChipStateEntity:icM,transfer:Jkh,trendingOfferEntity:VyV,videoDownloadContextEntity:mvA,
videoOverviewAsyncDataEntity:KiA,videoPlaybackPositionEntity:UvU,votingEntity:grh,ytMainChannelEntity:PmV,youchatPendingResponseEntity:q2h,ytMainDownloadedVideoEntity:gsz,ytMainVideoEntity:zCH};g.E(zc,VFz);zc.prototype.U=function(X){return X};
zc.prototype.G=function(X){if(X instanceof Uint8Array)throw iNA(0);return X};
g.E(B_,g.I);B_.prototype.observe=function(X){var c=this;this.observers.push(X);return function(){var V=c.observers.indexOf(X);V>=0&&c.observers.splice(V,1)}};
B_.prototype.G=function(X){rSr(this,X.data)};
B_.prototype.R2=function(){this.channel.close()};
var knM,Q5M=new g.RL("elementsCommand");var xo=new g.RL("entityBatchUpdate");var hUk=new g.RL("downloadStatusEntity");var kwH=new g.RL("mainPlaylistEntityActionMetadata");var sy=new g.RL("mainVideoEntityActionMetadata");var l0r=new g.RL("musicPlaylistEntityActionMetadata");var LXM=new g.RL("musicTrackEntityActionMetadata");var NIA=new g.RL("localImageEntityActionMetadata");var lD=new g.RL("playbackDataActionMetadata");var ZOi=new g.RL("transferEntityActionMetadata");var dRA=new g.RL("videoPlaybackPositionEntityActionMetadata");var NS_;new g.Ei;new g.Ei;zHp.prototype.request=function(X,c,V){c=c===void 0?{}:c;return this.locks.request(X,c,function(G){return V(G)})};var c$=g.NL.caches,XL,DBk;qW.prototype.open=function(X){return c$.open(soG(X))};
qW.prototype.has=function(X){return c$.has(soG(X))};
qW.prototype.delete=function(X){return c$.delete(soG(X))};
qW.prototype.match=function(X,c){var V=this,G,n,L,d,h,A;return g.O(function(Y){switch(Y.J){case 1:return g.b(Y,V.keys(),2);case 2:G=Y.G,n=g.r(G),L=n.next();case 3:if(L.done){Y.Wl(5);break}d=L.value;return g.b(Y,V.open(d),6);case 6:return h=Y.G,g.b(Y,h.match(X,c),7);case 7:if(A=Y.G)return Y.return(A);L=n.next();Y.Wl(3);break;case 5:return Y.return()}})};
g.E(Knt,qW);Knt.prototype.keys=function(){var X,c,V,G,n,L,d,h,A;return g.O(function(Y){if(Y.J==1)return X=[],c=g.SP("CacheStorage keys"),g.b(Y,c$.keys(),2);V=Y.G;G=g.r(V);for(n=G.next();!n.done;n=G.next()){L=n.value;var H=L.indexOf(":");d=H===-1?{Ci:L}:{Ci:L.substring(0,H),datasyncId:L.substring(H+1)};h=d.Ci;A=d.datasyncId;A===c&&X.push(h)}return Y.return(X)})};g.E(G6,g.I);G6.prototype.U=function(X){this.api.z_("onOfflineOperationFailure",X.data)};
G6.prototype.X=function(X){this.api.publish("offlinetransferpause",X.data)};
G6.prototype.R2=function(){var X;(X=this.J)==null||X.close();var c;(c=this.G)==null||c.close()};qhz.prototype.U5=function(){this.J&&LV(this)};
qhz.prototype.S4=function(){this.G&&this.G.resolve();this.U=this.J=!1;this.C()};var pLA=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var Fhk="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var mPU="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.E(SI7,bD);SI7.prototype.G=function(X){return Ag(X)?XLz(this,X):Yo(X)?GKt(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};g.E(nGz,bD);nGz.prototype.G=function(X){return Yo(X)?LlU(this,X):yep(X)?yBA(this,X):je(X)?hDi(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};g.y=ABG.prototype;g.y.E9_=function(X){var c=this,V,G,n,L;return g.O(function(d){if(!g.B(X.state,128))return d.Wl(0);V=X.state.oP;var h=(G=V)==null?void 0:G.errorCode,A=(n=V)==null?void 0:n.gL;L=h==="net.connect"&&A===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(h==null?0:h.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.b(d,c.YD(c.player.getVideoData().videoId,L),0)})};
g.y.YD=function(X,c){var V=this;return g.O(function(G){if(G.J==1){if(V.G)return G.return();V.G=!0;return c==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(fV(V,X,!1,!0),G.Wl(0)):g.b(G,g5(V,X),3)}g.bj(X,4);return g.b(G,V.J.YD(c),0)})};
g.y.iC=function(X){X.status===2?(X.status!==this.U&&(Loz(this.J),g.bj(X.videoId,2)),X.CL&&Yvt(this.J,X.videoId,X.CL)):X.status===4?(g5(this,X.videoId),this.YD(X.videoId,X.xT?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):X.status===1&&AxV(this.J);this.U=X.status;this.api.z_("localmediachange",{videoId:X.videoId,status:X.status})};
g.y.xL=function(){var X=this,c;return g.O(function(V){if(V.J==1){if(X.G)return V.return();X.G=!0;c=X.player.getVideoData().videoId;return g.b(V,g5(X,c),2)}return g.b(V,X.J.xL(),0)})};
g.y.Cs=function(X){switch(X){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.y.S=function(X){return this.api.j().S(X)};g.E(wLV,bD);wLV.prototype.G=function(X){return Ag(X)?EGh(this,X):Yo(X)?rBM(this,X):yep(X)?QIz(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};eDG.prototype.J=function(X,c){var V=X.action.actionMetadata.priority-c.action.actionMetadata.priority;V===0&&(X.J<c.J?V=-1:X.J>c.J&&(V=1));return V};g.E(pV,g.I);pV.prototype.R2=function(){this.C&&this.C();g.I.prototype.R2.call(this)};
pV.prototype.createAction=function(X,c){var V=g.jE(X.entityKey).entityType,G=g.JI(16);return new w5(V,G,X,c.actionId,c.rootActionId)};
pV.prototype.A7=function(X){var c=this,V,G,n,L,d,h,A,Y,H;return g.O(function(a){if(a.J==1){if(c.vl())return a.return();G=(V=X.offlineOrchestrationActionWrapperEntity)!=null?V:new Set;n=[];L=g.r(G);for(d=L.next();!d.done;d=L.next())h=d.value,A=g.jE(h),Y=A.entityId,RDA(c.J,Y)||n.push(h);return g.b(a,UR7(c,n),2)}H=a.G;return g.b(a,NbG(c,H),0)})};
pV.prototype.retry=function(){var X=this;return g.O(function(c){return g.b(c,Tbk(X),0)})};P_p.prototype.s_=function(X,c){c=c===void 0?!0:c;var V=this,G,n,L,d,h,A,Y,H;return g.O(function(a){switch(a.J){case 1:if(!V.J)return a.return();G=[];n=g.G$(V.J.G,c);L=[];for(d={hB:0};d.hB<n.length;d={hB:d.hB},d.hB++)h=n[d.hB],A=V.J.mR(h,"json3"),Y=g.l9(A,{withCredentials:!0,format:"RAW"},3,500).then(function(W){return function(w){w={metadata:g.Wp(n[W.hB]),trackData:w.xhr.responseText};L.push(w)}}(d)).Vr(function(W){V2("Caption fetch error",W)}),G.push(Y);
return g.b(a,AWr(G),2);case 2:return g.ZS(a,3),g.b(a,Oek(X,L),5);case 5:g.vw(a,0);break;case 3:H=g.k1(a),V2("Caption DB transaction error",H),g.Ql(a)}})};g.E(I1,g.I);I1.prototype.R2=function(){this.G&&this.G();g.I.prototype.R2.call(this)};
I1.prototype.U=function(X){var c=this,V,G,n,L,d,h,A,Y;return g.O(function(H){G=(V=X.transfer)!=null?V:new Set;n=[];L=g.r(G);for(d=L.next();!d.done;d=L.next())h=d.value,A=g.jE(h),Y=A.entityId,n.push(Y);return n.length===0?H.return():g.b(H,Klp(c,n),0)})};g.E(iOi,g.I);g.y=iOi.prototype;g.y.R2=function(){this.kO&&this.kO();this.NW.dispose();this.X.dispose();this.Hl&&g.Tv(this.B.S_,this.Hl);this.wy&&g.Tv(this.B.S_,this.wy);g.I.prototype.R2.call(this)};
g.y.lLh=function(X){var c=this,V,G,n;return g.O(function(L){switch(L.J){case 1:V=g.Hc(X,"transfer");if(c.J&&V===c.J.key){fV(c.D,c.Z,!0);c.X.stop();L.Wl(0);break}return g.b(L,K6(c.G,{mode:"readwrite",SS:!0},function(d){return NW(d,V,"transfer").then(function(h){if(h&&h.transferState!=="TRANSFER_STATE_COMPLETE"&&h.transferState!=="TRANSFER_STATE_FAILED")return h.transferState="TRANSFER_STATE_PAUSED_BY_USER",u2(d,h,"transfer").then(function(){return h})})}),3);
case 3:G=L.G;if(!G){L.Wl(0);break}if(!X||!c.U){L.Wl(5);break}return g.b(L,H$(X,c.U,c.G,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.b(L,T6(c,X),7);case 7:n=L.G,Lht({videoId:X,U2:G,offlineModeType:n}),g.Ql(L)}})};
g.y.MXS=function(){var X=this;if(this.J&&this.Z){fV(this.D,this.Z,!1);var c=this.J,V=(c==null?0:c.key)?g.jE(c.key).entityId:"";V&&this.U&&(new Promise(function(G,n){H$(V,X.U,X.G,"DOWNLOAD_STATE_PAUSED").catch(function(L){n(L)})})).catch(function(G){V2("Download state setting error",G)})}this.X.stop()};
g.y.Q4=function(){this.J?cx_(this,this.J):Uy(this)};
g.y.Qn=function(X){var c=this;return g.O(function(V){switch(V.J){case 1:if(!c.J){V.Wl(2);break}if(c.J.transferState==="TRANSFER_STATE_COMPLETE"||c.J.transferState==="TRANSFER_STATE_FAILED"||!X.transfer||!X.transfer.has(c.J.key)){V.Wl(3);break}return g.b(V,Do(c.G,c.J.key,"transfer"),4);case 4:c.J=V.G;if(c.J){V.Wl(3);break}return g.b(V,VkH(c),3);case 3:if(c.J)return V.return();case 2:return g.b(V,Uy(c),0)}})};
g.y.YD=function(X,c){var V=this,G,n,L,d,h;return g.O(function(A){switch(A.J){case 1:if(!V.J){uD(V,"onTransferFailure: "+X);A.Wl(2);break}G=V.J;L=((n=G)==null?0:n.key)?g.jE(G.key).entityId:"";a:switch(X){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var Y=!1;break a;default:Y=!0}return Y&&jbU(V)?g.b(A,P$(V,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.b(A,
HT7(V,X),5);case 5:if(!L||!V.U){A.Wl(2);break}return g.b(A,H$(L,V.U,V.G,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.b(A,T6(V,L),9);case 9:d=A.G;y2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:L,U2:G,offlineModeType:d});if(!L||!V.U){A.Wl(2);break}return g.b(A,H$(L,V.U,V.G,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:NH(V),h=Uy(V,!0),c&&c(h),g.Ql(A)}})};
g.y.xL=function(X){var c=this,V,G,n,L,d,h,A,Y,H,a,W,w;return g.O(function(F){switch(F.J){case 1:if(!c.J){uD(c,"onMaybeTransferStreamsExpired");F.Wl(2);break}return jbU(c)?g.b(F,P$(c,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.b(F,HT7(c,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!c.U){F.Wl(2);break}V=c.J;n=((G=V)==null?0:G.key)?g.jE(V.key).entityId:"";if(!n){F.Wl(2);break}return g.b(F,H$(n,c.U,c.G,"DOWNLOAD_STATE_FAILED"),2);case 9:return c.J||uD(c,"onMaybeTransferStreamsExpiredRetryAttempting"),
L=c.J,h=((d=L)==null?0:d.key)?g.jE(L.key).entityId:"",g.b(F,T6(c,h),10);case 10:return A=F.G,y2({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:h,U2:L,offlineModeType:A}),Y=j5k(),g.z8(Y,lD,{isEnqueuedForExpiredStreamUrlRefetch:!0}),H=g.Hc(h,"playbackData"),a={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:H,actionMetadata:Y},W=Ey(new w5("playbackData",h,a)),g.b(F,C6(c.G,W,"offlineOrchestrationActionWrapperEntity"),2);case 2:NH(c),w=Uy(c,!0),
X&&X(w),g.Ql(F)}})};
var wAk={},aFG=(wAk.TRANSFER_STATE_TRANSFERRING=1,wAk.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,wAk);g.y=z6.prototype;g.y.O9=function(){return this.Z.promise};
g.y.cR=function(){if(this.G&&this.D)return this.Z.promise;w6t(this).then(this.Z.resolve).catch(this.Z.reject);return this.Z.promise};
g.y.h6=function(X){var c={};return c.playbackData=new SI7(X,this.qW,this.J),c.transfer=new wLV(X,this.qW),c.videoPlaybackPositionEntity=new nGz(X,this.qW),c};
g.y.d2=function(){var X=this;return g.O(function(c){return X.G?g.b(c,qV7(X.G),0):c.Wl(0)})};
g.y.SJ=function(){var X=this,c,V;return g.O(function(G){if(G.J==1)return X.G||X.D?g.b(G,X.O9(),2):G.return();X.T!==void 0&&(g.xP(X.T),X.T=void 0);X.X!==void 0&&(g.xP(X.X),X.X=void 0);(c=X.G)==null||c.dispose();X.G=void 0;(V=X.D)==null||V.dispose();X.D=void 0;X.api.z_("onOrchestrationLostLeader");X.Z=new g.Ei;g.Ql(G)})};
g.y.isOrchestrationLeader=function(){return this.U.J};
g.y.ZK=function(){return g.O(function(X){return X.return(!1)})};
g.y.qq=function(X){var c=this.J;c.api.publish("offlinetransferpause",X);var V;(V=c.G)==null||V.postMessage(X)};
g.y.Q4=function(X){var c,V;return g.O(function(G){if(G.J==1)return g.b(G,i2(),2);c=G.G;if(!c)return G.return();V=g.Hc(X,"transfer");return g.b(G,K6(c,{mode:"readwrite",SS:!0},function(n){var L=NW(n,V,"transfer"),d=NW(n,g.Hc(X,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.eA.all([L,d]).then(function(h){h=g.r(h);var A=h.next().value;var Y=h.next().value;return A&&A.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(A.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",u2(n,A,"transfer").then(function(){y2({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:X,U2:A,offlineModeType:Y==null?void 0:Y.offlineModeType});return g.eA.resolve(null)})):g.eA.resolve(null)})}),0)})};
g.y.mN=function(X){X=X===void 0?43200:X;var c=this,V,G,n,L,d,h,A,Y;return g.O(function(H){if(H.J==1)return c.B.wJ()?g.b(H,i2(),2):H.return(FoA());if(H.J!=3){V=H.G;if(!V)return H.return([]);G=Date.now()/1E3;return g.b(H,SJ(V,"offlineVideoPolicy"),3)}n=H.G;L=[];d=g.r(n);for(h=d.next();!h.done;h=d.next())A=h.value,Number(A.lastUpdatedTimestampSeconds)+X<=G&&(Y=g.jE(A.key).entityId,L.push(Y));return L.length?H.return(B$(c,L,c.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):H.return([])})};
g.y.deleteAll=function(){return B$(this,["!*$_ALL_ENTITIES_!*$"],this.C,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.y.refreshAllStaleEntities=function(X){var c=this;return g.O(function(V){return V.J==1?g.b(V,c.mN(X),2):V.return(V.G)})};
g.y.setUpPositionSyncInterval=function(X){var c=this;this.X!==void 0&&(g.xP(this.X),this.X=void 0);var V=X!=null?X:864E5;this.X=g.Q8(function(){c.WH(V)},V)};
g.y.WH=function(X){var c=this,V,G,n,L,d,h;return g.O(function(A){switch(A.J){case 1:return g.ZS(A,2),g.b(A,f6.getInstance(),4);case 4:V=A.G;if(!V)throw Error("prefStorage is undefined");return g.b(A,V.get("psi"),5);case 5:G=A.G;L=((n=G)==null?0:n.BI)?Number(G.BI)/1E3:0;d=Date.now();if(!(L+X<=d)){A.Wl(6);break}return g.b(A,B$(c,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.vw(A,0);break;case 2:h=g.k1(A),V2("Offline manager error",h),
g.Ql(A)}})};
g.y.Ei=function(){var X=this,c,V,G,n,L,d,h;return g.O(function(A){if(A.J==1)return g.b(A,i2(),2);if(A.J!=3)return(c=A.G)?g.b(A,SJ(c,"transfer"),3):A.return([]);V=A.G;G=[];n=g.r(V);for(L=n.next();!L.done;L=n.next())d=L.value,d.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&d.key&&(h=g.jE(d.key).entityId,G.push(h));return A.return(rxU(X,G))})};
g.y.Eu=function(){return g.O(function(X){return X.return([])})};
g.y.Qw=function(){return g.O(function(X){g.Ql(X)})};
g.y.nR=function(){return g.O(function(X){g.Ql(X)})};g.E(QbH,bD);QbH.prototype.G=function(X){return Ag(X)?vDi(this,X):Yo(X)?oDG(this,X):je(X)?eFV(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};
var KV=[10];g.E(tki,bD);tki.prototype.G=function(X){return Ag(X)?Mk_(this,X):Yo(X)?gDA(this,X):je(X)?fFk(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};
var lFA=[10];g.E(IFH,bD);IFH.prototype.G=function(X){return Yo(X)?UwG(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};g.E(TIr,z6);g.y=TIr.prototype;g.y.h6=function(X){var c=z6.prototype.h6.call(this,X);c.mainVideoEntity=new tki(X,this.qW,this.J);c.mainPlaylistEntity=new QbH(X,this.qW,this.J);c.mainDownloadsListEntity=new IFH(X,this.qW,this.J);return c};
g.y.refreshAllStaleEntities=function(X,c){var V=this,G,n,L,d,h,A,Y,H,a,W,w;return g.O(function(F){switch(F.J){case 1:G=[];if(!V.qW.S("web_player_offline_playlist_auto_refresh")){F.Wl(2);break}return g.b(F,unV(V,X,c),3);case 3:G=F.G;case 2:return g.b(F,f6.getInstance(),4);case 4:return n=F.G,g.b(F,(L=n)==null?void 0:L.get("sdois"),5);case 5:return d=F.G,g.b(F,(h=n)==null?void 0:h.get("lmqf"),6);case 6:A=F.G;if(!d){F.Wl(7);break}H=G;a=H.concat;return g.b(F,PbV(V,d,(Y=A)!=null?Y:"SD",X===0),8);case 8:G=
a.call(H,F.G);case 7:return W=G,w=W.concat,g.b(F,z6.prototype.refreshAllStaleEntities.call(V,X,c),9);case 9:return G=w.call(W,F.G),F.return(G)}})};
g.y.ZK=function(X){var c,V,G,n,L,d,h,A;return g.O(function(Y){if(Y.J==1)return g.b(Y,i2(),2);if(Y.J!=3)return(c=Y.G)?g.b(Y,Do(c,g.tJ,"mainDownloadsListEntity"),3):Y.return(!1);V=Y.G;if((G=V)==null?0:(n=G.downloads)==null?0:n.length)for(L=g.Hc(X,"mainVideoEntity"),d=g.r(V.downloads),h=d.next();!h.done;h=d.next())if(A=h.value,A.videoItem===L)return Y.return(!0);return Y.return(!1)})};
g.y.Eu=function(){var X=this,c,V,G,n,L,d,h,A;return g.O(function(Y){if(Y.J==1)return g.b(Y,i2(),2);if(Y.J!=3)return(c=Y.G)?g.b(Y,SJ(c,"downloadStatusEntity"),3):Y.return([]);V=Y.G;G=[];n=g.r(V);for(L=n.next();!L.done;L=n.next())d=L.value,d.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&d.key&&(h=g.jE(d.key).entityId,G.push(h));return G.length?(A={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},Y.return(B$(X,G,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
A))):Y.return([])})};
g.y.nR=function(){var X;return g.O(function(c){return c.J==1?g.b(c,i2(),2):(X=c.G)?g.b(c,K6(X,{mode:"readwrite",SS:!0},function(V){return Us(V,"mainVideoEntity").then(function(G){var n=[];G=g.r(G);for(var L=G.next();!L.done;L=G.next()){L=L.value;var d=void 0;(d=L.userState)!=null&&d.playbackPosition||(d=g.jE(L.key).entityId,d={key:g.Hc(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:"0"},n.push(u2(V,d,"videoPlaybackPositionEntity")),L.userState={playbackPosition:d.key},n.push(u2(V,
L,"mainVideoEntity")))}return g.eA.all(n)})}),0):c.return()})};
g.y.Qw=function(){var X,c,V,G,n,L,d,h,A,Y,H,a,W,w,F,Z,v,e,m,t,f,U,C,K,nj,yl,Xl,u,q,Q,P,UD,Zi,ah,Js,SD,Lt,wM;return g.O(function(k){if(k.J==1)return g.b(k,i2(),2);if(k.J!=3){X=k.G;if(!X)return k.return();c=g.Hc("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.b(k,K6(X,{mode:"readonly",SS:!0},function(J){return g.eA.all([NW(J,c,"mainDownloadsListEntity"),NW(J,g.tJ,"mainDownloadsListEntity"),Us(J,"mainVideoEntity"),Us(J,"mainPlaylistEntity")])}),3)}V=k.G;
G=g.r(V);n=G.next().value;L=G.next().value;d=G.next().value;h=G.next().value;A=n;Y=L;H=d;a=h;W=new Set;if((w=A)==null?0:(F=w.downloads)==null?0:F.length)for(Z=g.r(A.downloads),v=Z.next();!v.done;v=Z.next())e=v.value,m=void 0,(t=(m=e.videoItem)!=null?m:e.playlistItem)&&W.add(t);if((f=Y)==null?0:(U=f.downloads)==null?0:U.length)for(C=g.r(Y.downloads),K=C.next();!K.done;K=C.next())nj=K.value,nj.videoItem&&W.add(nj.videoItem);yl=new Set;Xl=[];u=g.r(a);for(q=u.next();!q.done;q=u.next()){Q=q.value;if(Q.videos)for(P=
g.r(Q.videos),UD=P.next();!UD.done;UD=P.next())Zi=UD.value,(ah=JSON.parse(g.jE(Zi).entityId).videoId)&&yl.add(ah);Q.key&&!W.has(Q.key)&&Xl.push(Q.key)}Js=g.r(H);for(SD=Js.next();!SD.done;SD=Js.next())Lt=SD.value,Lt.key&&!W.has(Lt.key)&&(wM=g.jE(Lt.key).entityId,yl.has(wM)||Xl.push(Lt.key));return Xl.length?g.b(k,kSA(X,Xl),0):k.Wl(0)})};g.E(zFp,bD);zFp.prototype.G=function(X){return Ag(X)?KoV(this,X):Yo(X)?sbM(this,X):je(X)?Cbt(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};
var CV=[10];g.E(Sv7,bD);Sv7.prototype.G=function(X){return Ag(X)?qvh(this,X):Yo(X)?XA_(this,X):je(X)?cLk(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};
var Dj=[10];g.E(nfA,bD);nfA.prototype.G=function(X){return Ag(X)?hgz(this,X):Yo(X)?ALh(this,X):je(X)?YaV(this,X):Promise.reject(Error("Unsupported action type: "+X.actionType))};
var yLi=[10];g.E(Se,z6);Se.prototype.h6=function(X){var c=z6.prototype.h6.call(this,X);c.musicTrack=new nfA(X,this.J);c.musicPlaylist=new Sv7(X,this.J);c.musicAlbumRelease=new zFp(X,this.J);return c};
Se.prototype.refreshAllStaleEntities=function(X,c){var V=this,G,n,L;return g.O(function(d){if(d.J==1)return g.b(d,HKp(V,X,c),2);if(d.J!=3)return n=G=d.G,L=n.concat,g.b(d,z6.prototype.refreshAllStaleEntities.call(V,X,c),3);G=L.call(n,d.G);return d.return(G)})};g.E(aPp,g.wh);g.y=aPp.prototype;g.y.create=function(){var X=this;g.N(this,this.events);g.Dv(this.qW)?this.J=new TIr(this.qW,this.player):g.Ty(this.qW)&&(this.J=new Se(this.qW,this.player));this.events.L(this.player,"onPlaybackStartExternal",function(){X.F$()});
this.events.L(this.player,"videodatachange",function(){X.F$()});
this.qW.S("html5_offline_playback_position_sync")&&this.events.L(this.player,"presentingplayerstatechange",this.ex)};
g.y.Ut=function(){return!1};
g.y.h$=function(X,c,V,G){var n=this;return g.O(function(L){return n.J?L.return(B$(n.J,X,c,V,G)):L.return(Promise.reject())})};
g.y.deleteAll=function(){return this.J.deleteAll()};
g.y.mN=function(X){return this.J.mN(X)};
g.y.refreshAllStaleEntities=function(X){return this.J.refreshAllStaleEntities(X)};
g.y.setUpPositionSyncInterval=function(X){this.J.setUpPositionSyncInterval(X)};
g.y.qq=function(X){this.J.qq(X)};
g.y.Q4=function(X){return this.J.Q4(X)};
g.y.F$=function(){var X=this,c;return g.O(function(V){c=X.player.getVideoData();return g.iN(c)?$KU(c)&&X.G!==c.clientPlaybackNonce?g.b(V,WXr(X,c),0):V.Wl(0):V.return()})};
g.y.ex=function(X){var c=this,V,G,n,L,d,h,A;return g.O(function(Y){if(Y.J==1)return V=c.player.getVideoData(),G=V.LS,g.rR(X,2)||g.rR(X,512)?g.b(Y,i2(),2):Y.return();if(Y.J!=3){n=Y.G;if(!n)return V2("PES is undefined"),Y.return();L=V.videoId;return g.b(Y,Do(n,g.Hc(L,"mainVideoEntity"),"mainVideoEntity"),3)}d=Y.G;if(!d)return Y.return();h=Math.floor(G).toString();A={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:h}};return g.b(Y,c.h$([L],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
A),0)})};
g.y.isOrchestrationLeader=function(){return this.J.isOrchestrationLeader()};
g.y.updateDownloadState=function(X,c){var V,G,n,L;return g.O(function(d){if(d.J==1)return g.b(d,i2(),2);V=d.G;if(!V)return V2("PES is undefined"),d.return();G=g.jE(X);n=G.entityType;L=G.entityId;return g.b(d,H$(L,n,V,c,!0),0)})};g.Wr("offline",aPp);})(_yt_player);
